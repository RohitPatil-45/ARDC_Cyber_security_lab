<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:include="template :: headFragment(${pageTitle})"></head>

<body class="hold-transition sidebar-mini layout-fixed">
	<div class="wrapper">

		<div th:replace="fragments/header :: header"></div>

		<div th:replace="fragments/sidebar :: aside"></div>

		<div class="content-wrapper">

			<section class="content-header">
				<div class="container-fluid">
					<div class="row mb-2">
						<div class="col-sm-6">
							<h1>Status wise VM Report</h1>
						</div>
						<div class="col-sm-6">
							<ol class="breadcrumb float-sm-right">
								<li class="breadcrumb-item"><a href="#">Home</a></li>
								<li class="breadcrumb-item active">VM Activity</li>
							</ol>
						</div>
					</div>
				</div>
			</section>

			<!-- Main content -->
			<section class="content">
				<div class="container-fluid">
					<div class="row" id="statusWiseReport_div_dropdown">
						<div class="col-md-12">
							<div class="card card-secondary">
								<div class="card-header">
									<div class="row">
										<div class="col-md-10">
											<h3 class="card-title" style="padding-top: 10px">[[${pageTitle}]]</h3>
										</div>
									</div>
								</div>
								<form th:action="${'/report/statusWiseReport'}" th:method="POST"
									enctype="multipart/form-data" th:object="${objEnt}">
									<div class="card-body" id="reportForm">
										<div class="row">
											<div class="col-md-6">
												<div class="form-group">
													<label>Status</label> <select tabindex="1" id="vm_status"
														th:field="*{vm_status}" required name="vm_status"
														class="form-control" multiple="multiple"
														style="width: 100%;">
														<!-- 														<option value=''>SELECT</option> -->
														<option value='off'>Off</option>
														<option value='running'>Running</option>
														<option value='shut off'>shut off</option>
														<option value='paused'>paused</option>
														<option value='unknown'>unknown</option>
														<option value='crashed'>crashed</option>
														<option value='suspended'>Suspended</option>
														<option value='stop'>Stop</option>
													</select>
												</div>
											</div>
										</div>
									</div>
									<div class="card-footer">
										<button type="submit" id="vmActivityBtn"
											class="btn btn-primary">Generate</button>
									</div>
								</form>
							</div>
						</div>
					</div>



					<div class="row" style="display: none;" id="reportdatafortable">
						<div class="col-12">
							<div class="card card-secondary">
								<!-- 								<div class="card-header"> -->
								<!-- 									<div class="row"> -->
								<!-- 										<div class="col-md-10"> -->
								<!-- 											<h3 class="card-title" style="padding-top: 10px">[[${pageTitle}]]</h3> -->

								<!-- 											<h3 class="card-title" style="padding-top: 10px">&nbsp;For&nbsp;"</h3> -->

								<!-- 											<h3 class="card-title" style="padding-top: 10px">[[${vmstatusSelectList}]]</h3> -->
								<!-- 											<h3 class="card-title" style="padding-top: 10px">"</h3> -->
								<!-- 										</div> -->
								<!-- 										<div class="col-md-2">
<!-- 											<a th:href="@{'/cloud_instance_user/vm_user'}" -->
								<!-- 												class="btn btn-block bg-gradient-primary">Create -->
								<!-- 												Instance</a> -->
								<!-- 										</div> -->

								<!-- 									</div> -->
								<!-- 									<div th:if="${message != null}" -->
								<!-- 										class="alert alert-success alert-dismissible fade show text-center message" -->
								<!-- 										role="alert"> -->
								<!-- 										[[${message}]] -->
								<!-- 										<button type="button" class="close btn-sm" -->
								<!-- 											data-dismiss="alert" aria-label="Close"> -->
								<!-- 											<span aria-hidden="true">&times;</span> -->
								<!-- 										</button> -->
								<!-- 									</div> -->
								<!-- 									<div th:if="${error != null}" -->
								<!-- 										class="alert alert-danger alert-dismissible fade show text-center message" -->
								<!-- 										role="alert"> -->
								<!-- 										[[${error}]] -->
								<!-- 										<button type="button" class="close btn-sm" -->
								<!-- 											data-dismiss="alert" aria-label="Close"> -->
								<!-- 											<span aria-hidden="true">&times;</span> -->
								<!-- 										</button> -->
								<!-- 									</div> -->
								<!-- 								</div> -->

								<div class="card-header">
									<div class="row">
										<div class="col-md-10">
											<h3 class="card-title" style="padding-top: 10px">[[${pageTitle}]]</h3>
										</div>
									</div>
								</div>
							</div>

							<div>
								<table id="example1" class="table table-bordered table-striped">
									<thead style="background-color: #e2e2e2">
										<tr>
											<th class="text-center">Billing Start Date</th>
											<th class="text-center">Instance IP</th>
											<th class="text-center">Cloud Instances</th>
											<th class="text-center">VM source</th>
											<th class="text-center">Instance ID</th>


											<th class="text-center">Status</th>
											<th class="text-center">VM Status</th>
											<!-- 											<th class="text-center">VM Status</th> -->
											<th class="text-center">Created on</th>

											<th class="text-center">OS</th>
											<th sec:authorize="hasRole('ROLE_SUPERADMIN')"
												class="text-center">Switch</th>
											<th class="text-center">Location</th>

											<th class="text-center">Device Mac</th>
											<th class="text-center">Hostname</th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="obj : ${listObj}" class="odd"
											style="background-color: #fff;">
											<td>[[${obj.created_on}]]</td>
											<td><span class="glow-span"
												th:if="${obj.instance_ip != null}"
												style="background-color: #f1faff; cursor: pointer">[[${obj.instance_ip}]]</span>

												<span th:if="${obj.instance_ip == null}">-</span></td>
											<td>
												<div class="row">
													<!-- 														<div class="col-md-2"> -->
													<!-- <!-- 															<i class="fa fa-windows" -->
													<!-- <!-- 																style="font-size: 35px; color: dodgerblue; padding-top: 2px"></i> -->
													<!-- 														</div> -->

													<div class="col-md-10">
														<h3 class="card-title"
															style="align-items: flex-start !important; flex-direction: column !important; display: flex;">

															<span class="card-title" th:value="${obj.id}"
																th:onclick="'viewCloudServerDetails(' + ${obj.id} + ')'"
																style="font-weight: bold; cursor: pointer;"
																th:oncontextmenu="return showContextMenu(event)">
																[[${obj.instance_name}]]</span> <span class="card-title"
																style="font-size: 1rem !important; color: #b5b5c3 !important">
																[[${obj.price_id.getvCpu}]] / [[${obj.price_id.getRam}]]
																/ [[${obj.price_id.getSsd_disk}]] /</span>
														</h3>
													</div>

												</div>
											</td>
											<td>[[${obj.virtualization_type}]]</td>
											<td>[[${obj.Id}]]</td>
											<!-- <td>[[${obj.instance_name}]]</td> -->


											<td><span style="cursor: pointer">[[${obj.request_status}]]</span>
											</td>
											<td th:text="${obj.vm_state}"></td>
											<!-- 
												<td
												th:text="${obj.vm_state == 'Off' ? 'stop' : obj.vm_state}"></td> -->
											<!-- 											<td>[[${obj.vm_start_stop_status}]]</td> -->
											<td>[[${obj.created_on}]]</td>

											<td>[[${obj.subproduct_id.getSub_product_name}]]</td>
											<td sec:authorize="hasRole('ROLE_SUPERADMIN')">[[${obj.switch_id.getSwitch_name}]]</td>
											<td>[[${obj.location_id.getLocation_name}]]</td>

											<td>[[${obj.mac_address}]]</td>
											<td>[[${obj.computer_name}]]</td>

										</tr>

									</tbody>
								</table>


							</div>

						</div>
					</div>
					<!-- /.container-fluid -->
			</section>
			<!-- /.content -->
		</div>
		<div th:replace="fragments/footer :: footer"></div>
	</div>

	<div th:replace="template :: jsscript"></div>
	<!-- <script th:src="@{/custom_js/vmReport.js}"></script> -->
	<script type="text/javascript"
		th:src="@{/webtemplate/plugins/jquery-validation/jquery.validate.min.js}"></script>
	<script type="text/javascript"
		th:src="@{/webtemplate/plugins/jquery-validation/additional-methods.min.js}"></script>
	<script
		th:src="@{/webtemplate/multiselect/bootstrap-multiselect.min.js}"></script>


	<script th:src="@{/webtemplate/plugins/sweetalert2/sweetalert2.min.js}"></script>
	<script th:src="@{/webtemplate/plugins/select2/js/select2.full.min.js}"></script>

	<script
		th:src="@{/webtemplate/plugins/datatables/jquery.dataTables.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-responsive/js/dataTables.responsive.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-responsive/js/responsive.bootstrap4.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-buttons/js/dataTables.buttons.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-buttons/js/buttons.bootstrap4.min.js}"></script>
	<script th:src="@{/webtemplate/plugins/jszip/jszip.min.js}"></script>
	<script th:src="@{/webtemplate/plugins/pdfmake/pdfmake.min.js}"></script>
	<script th:src="@{/webtemplate/plugins/pdfmake/vfs_fonts.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-buttons/js/buttons.html5.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-buttons/js/buttons.print.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-buttons/js/buttons.colVis.min.js}"></script>
</body>
<script type="text/javascript">
	$('document').ready(function() {

		var currentUrl = window.location.href;
		console.log("Current URL: " + currentUrl);

		// Example: check if the current URL contains a specific string
		if (currentUrl.includes("statusWiseReport")) {
			// Perform some action specific to the "statusWiseReport" page

			$('#statusWiseReport_div_dropdown').hide();
			$('#reportdatafortable').show();
		} else {
			$('#statusWiseReport_div_dropdown').show();
			$('#reportdatafortable').hide();
		}

		$('#vm_status').multiselect({
			enableFiltering : true,
			includeSelectAllOption : true,
			buttonWidth : '100%',
			maxHeight : 350,

		});

		$('#vm_status').keyup(function() {
			var vmStatus = $(this).val();
			if (vmStatus != '') {
				this.setCustomValidity('');
				$('#vmActivityBtn').prop('disabled', false);
			} else {
				this.setCustomValidity('Please select Vm Status');
			}
		});

	});
</script>

<script type="text/javascript">
	$(function() {

		// 		$('#statusWiseReport_div_dropdown').hide();
		//Initialize Select2 Elements
		$('.select2').select2()

		//Initialize Select2 Elements
		$('.select2bs4').select2({
			theme : 'bootstrap4'
		})

		$("#example1")
				.DataTable(
						{
							"responsive" : true,

							"lengthChange" : false,
							"autoWidth" : false,
							"buttons" : [
									{
										extend : 'csv',
										title : 'Data Export'
									},
									{
										extend : 'excel',
										title : 'Data Export'
									},
									{
										extend : 'pdf',
										title : 'Data Export',
										orientation : 'landscape',
										pageSize : 'A4',
										customize : function(doc) {
											var numColumns = doc.content[1].table.body[0].length;
											//alert(numColumns+1);
											// Set column widths (example values, adjust as needed)
											doc.content[1].table.widths = Array(
													numColumns + 1).fill('*');

											// Adjust margins and font sizes
											// 											doc.pageMargins = [ 10, 10, 10, 10 ];
											doc.defaultStyle.fontSize = 8;

											// Reduce header font size
											doc.styles.tableHeader.fontSize = 8;
											doc.styles.tableHeader.alignment = 'center';

											// Center-align table body cells
											doc.styles.tableBodyEven.alignment = 'center';
											doc.styles.tableBodyOdd.alignment = 'center';

											// Handle text overflow and wrapping
											doc.content
													.forEach(function(item) {
														if (item.table
																&& item.table.body) {
															item.table.body
																	.forEach(function(
																			row) {
																		row
																				.forEach(function(
																						cell) {
																					cell.margin = [
																							5,
																							2,
																							5,
																							2 ]; // Add margins for better readability
																					//	 										cell.fillColor = '#f2f2f2'; // Optional: set background color
																					cell.alignment = 'left'; // Optional: left-align text

																					if (typeof cell.text === 'string') {
																						// Insert line breaks every 30 characters (adjust as needed)
																						cell.text = cell.text
																								.replace(
																										/(.{1,30})/g,
																										'$1\n')
																								.trim();
																					}
																				});
																	});
														}
													});
											var tableWrapper = {
												table : doc.content[1].table,
												layout : 'noBorders',
												alignment : 'center',
												margin : [ 0, 0, 0, 0 ]
											// top, right, bottom, left
											};
											doc.content[1] = tableWrapper;

										},

									},
									{
										extend : 'print',
										customize : function(win) {
											$(win.document.body).find('table')
													.addClass('compact').css(
															'font-size', '8px')
													.css('width', '100%');
										}
									}, "colvis" ],
							"sScrollX" : "100%",
							"sScrollXInner" : "130%",
							"bScrollCollapse" : true,
							pageLength : 10,
							searching : true
						}).buttons().container().appendTo(
						'#example1_wrapper .col-md-6:eq(0)');

	});
</script>
<script type="text/javascript">
	
</script>
</html>