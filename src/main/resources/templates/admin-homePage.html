<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head th:include="template :: headFragment(${pageTitle})">
<title th:text="${pageTitle}">Admin Dashboard</title>
<link rel="icon" type="image/png" href="/webtemplate/dist/img/magicboxEye3.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<link rel="stylesheet" th:href="@{/css/dashboard.css}" />
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>

<style>
:root {
	--primary: #4361ee;
	--secondary: #3f37c9;
	--success: #4cc9f0;
	--danger: #f72585;
	--warning: #f8961e;
	--info: #4895ef;
	--dark: #2b2d42;
	--light: #f8f9fa;
}

.welcome-section {
	text-align: center;
	padding: 2rem 1rem;
	background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
	border-radius: 12px;
	color: white;
	margin-bottom: 2rem;
	position: relative;
	overflow: hidden;
}

.welcome-title {
	font-size: 2.5rem;
	font-weight: 800;
	line-height: 1;
	margin-bottom: 0.5rem;
	text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.welcome-subtitle {
	font-size: 1.1rem;
	opacity: 0.9;
	font-weight: 500;
}

.stats-card {
	background: white;
	border-radius: 12px;
	padding: 1.5rem;
	text-align: center;
	box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
	margin-bottom: 1rem;
	border: none;
	transition: transform 0.3s ease;
}

.stats-card:hover {
	transform: translateY(-5px);
}

.stats-number {
	font-size: 2.5rem;
	font-weight: 700;
	margin-bottom: 0.5rem;
	line-height: 1;
}

.stats-courses .stats-number {
	color: var(--primary);
}

.stats-teachers .stats-number {
	color: var(--success);
}

.stats-students .stats-number {
	color: var(--info);
}

.stats-subjects .stats-number {
	color: var(--warning);
}

.stats-batches .stats-number {
	color: var(--secondary);
}

.stats-label {
	font-size: 1rem;
	color: #6c757d;
	font-weight: 500;
}

.subject-badge {
	background: var(--light);
	color: var(--dark);
	padding: 0.3rem 0.6rem;
	border-radius: 15px;
	font-size: 0.8rem;
	margin: 0.1rem;
	display: inline-block;
	border: 1px solid #e9ecef;
	cursor: pointer;
}

.teacher-badge {
	background: #fff3cd;
	color: #856404;
	padding: 0.3rem 0.6rem;
	border-radius: 15px;
	font-size: 0.8rem;
	margin: 0.1rem;
	display: inline-block;
	border: 1px solid #ffeaa7;
}

.batch-badge {
	background: #d1ecf1;
	color: #0c5460;
	padding: 0.3rem 0.6rem;
	border-radius: 15px;
	font-size: 0.8rem;
	margin: 0.1rem;
	display: inline-block;
	border: 1px solid #bee5eb;
}

.subject-count-badge {
	background: #e7f3ff;
	color: #0d6efd;
	padding: 0.3rem 0.6rem;
	border-radius: 15px;
	font-size: 0.8rem;
	margin: 0.1rem;
	display: inline-block;
	border: 1px solid #b3d9ff;
}

/* DataTables Custom Styling */
.dataTables_wrapper .dt-buttons {
	margin-bottom: 10px;
}

.dataTables_wrapper .dt-buttons .btn {
	margin-right: 5px;
	margin-bottom: 5px;
}

#searchHeader {
	background-color: #f8f9fa;
}

.column-search {
	font-size: 0.875rem;
	padding: 0.25rem 0.5rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
	.welcome-title {
		font-size: 2rem;
	}
	
	.stats-number {
		font-size: 2rem;
	}
	
	.dataTables_wrapper .dt-buttons .btn {
		font-size: 0.8rem;
		padding: 0.25rem 0.5rem;
	}
}
</style>

<body class="hold-transition sidebar-mini layout-fixed">
	<div class="wrapper">
		<div th:replace="fragments/header :: header"></div>
		<div th:replace="fragments/side-barAdmin :: aside"></div>

		<div class="content-wrapper">
			<!-- Header -->
			<section class="content-header">
				<div class="container-fluid">
					<div class="row align-items-center mb-4">
						<div class="col-sm-6">
							<h1>
								<i class="fas fa-user-shield mr-3"></i> <span th:text="${pageTitle}">Admin Dashboard</span>
							</h1>
						</div>
						<div class="col-sm-6">
							<ol class="breadcrumb float-sm-right">
								<li class="breadcrumb-item"><a href="#">Home</a></li>
								<li class="breadcrumb-item active" th:text="${pageTitle}">Admin Dashboard</li>
							</ol>
						</div>
					</div>
				</div>
			</section>

			<!-- Main Content -->
			<section class="content">
				<div class="container-fluid">

					<!-- Welcome Section -->
					<div class="row mb-4">
						<div class="col-12">
							<div class="welcome-section">
								<div class="welcome-title" th:text="'Welcome, ' + ${admin?.name} + '!'">Welcome, Admin!</div>
								<div class="welcome-subtitle" th:if="${department}" th:text="'Managing: ' + ${department.departmentName} + ' Department'">
									Managing Department Operations
								</div>
							</div>
						</div>
					</div>

					<!-- Statistics Cards -->
					<div class="row mb-4">
						<div class="col-lg-2 col-md-4 col-sm-6">
							<div class="stats-card stats-courses">
								<div class="stats-number" th:text="${overallCourses}">0</div>
								<div class="stats-label">Total Courses</div>
							</div>
						</div>
						<div class="col-lg-2 col-md-4 col-sm-6">
							<div class="stats-card stats-teachers">
								<div class="stats-number" th:text="${overallTeachers}">0</div>
								<div class="stats-label">Teachers</div>
							</div>
						</div>
						<div class="col-lg-2 col-md-4 col-sm-6">
							<div class="stats-card stats-students">
								<div class="stats-number" th:text="${overallStudents}">0</div>
								<div class="stats-label">Students</div>
							</div>
						</div>
						<div class="col-lg-2 col-md-4 col-sm-6">
							<div class="stats-card stats-subjects">
								<div class="stats-number" th:text="${overallSubjects}">0</div>
								<div class="stats-label">Subjects</div>
							</div>
						</div>
						<div class="col-lg-2 col-md-4 col-sm-6">
							<div class="stats-card stats-batches">
								<div class="stats-number" th:text="${totalBatches}">0</div>
								<div class="stats-label">Batches</div>
							</div>
						</div>
						<div class="col-lg-2 col-md-4 col-sm-6">
							<div class="stats-card">
								<div class="stats-number" th:text="${totalSemesters}">0</div>
								<div class="stats-label">Semesters</div>
							</div>
						</div>
					</div>

					<!-- Error Message -->
					<div th:if="${error}" class="alert alert-danger">
						<i class="fas fa-exclamation-triangle mr-2"></i> <span th:text="${error}"></span>
					</div>

					<!-- Success Message -->
					<div th:if="${message != null}" class="alert alert-success alert-dismissible fade show text-center" role="alert">
						[[${message}]]
						<button type="button" class="close btn-sm" data-dismiss="alert" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>

					<!-- Course Management Table -->
					<div class="card">
						<div class="card-header">
							<div class="row">
								<div class="col-md-10">
									<h5 class="mb-0">
										<i class="fas fa-table me-2"></i>Course Management <span class="badge badge-primary ml-2" th:text="'Total: ' + ${courseDetails.size()}"></span>
									</h5>
								</div>
							</div>
						</div>
						<div class="card-body">
							<div class="table-responsive">
								<table id="courseTable" class="table table-bordered table-striped">
									<thead class="thead-light">
										<tr>
											<th scope="col">Sr No.</th>
											<th scope="col">Course</th>
											<th scope="col">Semesters</th>
											<th scope="col">Batches</th>
											<th scope="col">Teachers</th>
											<th scope="col">Students</th>
											<th scope="col">Subjects</th>
										</tr>
									</thead>
									<thead class="thead-light" id="searchHeader" style="display: none;">
										<tr>
											<th scope="col"></th>
											<th scope="col"><input type="text" class="form-control form-control-sm column-search" placeholder="Search course" data-column="1"></th>
											<th scope="col"><input type="text" class="form-control form-control-sm column-search" placeholder="Search semesters" data-column="2"></th>
											<th scope="col"><input type="text" class="form-control form-control-sm column-search" placeholder="Search batches" data-column="3"></th>
											<th scope="col"><input type="text" class="form-control form-control-sm column-search" placeholder="Search teachers" data-column="4"></th>
											<th scope="col"></th>
											<th scope="col"></th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="courseData, stat : ${courseDetails}">
											<th scope="row" th:text="${stat.count}">1</th>

											<!-- Course -->
											<td>
												<strong th:text="${courseData.course.courseName}">Course Name</strong> 
												<br> 
												<small class="text-muted" th:text="${courseData.course.courseCode}">Course Code</small>
											</td>

											<!-- Semesters -->
											<td>
												<div th:if="${!#lists.isEmpty(courseData.semesters)}">
													<div th:each="semester : ${courseData.semesters}">
														<span class="subject-badge" 
															th:text="${semester.semesterName}"
															th:onclick="|showSubject(${semester.semesterId})|"> 
														</span>
													</div>
												</div>
												<div th:if="${#lists.isEmpty(courseData.semesters)}">
													<span class="text-muted">No Semesters</span>
												</div>
											</td>

											<!-- Batches -->
											<td>
												<div th:each="batch : ${courseData.batches}">
													<span class="batch-badge" th:text="${batch.batchName}">Batch</span>
												</div>
												<div th:if="${courseData.batches.empty}">
													<span class="text-muted">No Batches</span>
												</div>
											</td>

											<!-- Teachers -->
											<td>
												<div th:each="teacher : ${courseData.teachers}">
													<span class="teacher-badge" th:text="${teacher}">Teacher</span>
												</div>
												<div th:if="${courseData.teachers.empty}">
													<span class="text-muted">No Teachers</span>
												</div> 
												<small class="text-muted" th:if="${courseData.teacherCount > 0}" th:text="'Total: ' + ${courseData.teacherCount}"></small>
											</td>

											<!-- Students -->
											<td class="text-center">
												<span class="badge badge-primary" th:text="${courseData.studentCount}">0</span>
											</td>

											<!-- Subjects -->
											<td class="text-center">
												<span class="subject-count-badge" th:text="${courseData.subjectCount}">0</span>
											</td>
										</tr>

										<!-- Empty State -->
										<tr th:if="${courseDetails.empty}">
											<td colspan="7" class="text-center py-5 text-muted">
												<i class="fas fa-inbox fa-2x mb-3"></i>
												<div>
													<strong>No Courses Found</strong>
													<p class="mb-0">No courses available in this department.</p>
												</div>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>

		<div th:replace="fragments/footer :: footer"></div>
	</div>

	<div th:replace="template :: jsscript"></div>
	
	<!-- DataTables Scripts -->
	<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
	<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
	<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
	<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
	<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>

	<script type="text/javascript">
		$(document).ready(function() {
			// Initialize DataTable with export options
			var table = $('#courseTable').DataTable({
				"responsive": true,
				"lengthChange": true,
				"autoWidth": false,
				"pageLength": 10,
				"dom": '<"row"<"col-md-6"B><"col-md-6"f>><"row"<"col-md-12"tr>><"row"<"col-md-5"i><"col-md-7"p>>',
				"buttons": [
					{
						extend: 'collection',
						className: 'btn btn-secondary',
						text: '<i class="fas fa-cog"></i> Options',
						buttons: [
							{
								extend: 'copy',
								className: 'btn btn-secondary',
								text: '<i class="fas fa-copy"></i> Copy',
								exportOptions: {
									columns: [0, 1, 2, 3, 4, 5, 6]
								}
							},
							{
								extend: 'excel',
								className: 'btn btn-success',
								text: '<i class="fas fa-file-excel"></i> Excel',
								exportOptions: {
									columns: [0, 1, 2, 3, 4, 5, 6]
								}
							},
							{
								extend: 'pdf',
								className: 'btn btn-danger',
								text: '<i class="fas fa-file-pdf"></i> PDF',
								exportOptions: {
									columns: [0, 1, 2, 3, 4, 5, 6]
								}
							},
							{
								extend: 'print',
								className: 'btn btn-info',
								text: '<i class="fas fa-print"></i> Print',
								exportOptions: {
									columns: [0, 1, 2, 3, 4, 5, 6]
								}
							},
							{
								text: '<i class="fas fa-search"></i> Toggle Search',
								className: 'btn btn-warning',
								action: function ( e, dt, node, config ) {
									$('#searchHeader').toggle();
									// Adjust table header if needed
									table.columns.adjust();
								}
							}
						]
					}
				],
				"language": {
					"search": "Global Search:",
					"lengthMenu": "Show _MENU_ entries"
				}
			});
			
			// Individual column search
			$('#courseTable thead').on('keyup', '.column-search', function() {
				var columnIndex = $(this).data('column');
				table.column(columnIndex).search(this.value).draw();
			});
		});

		function viewCourseDetails(courseId) {
			window.location.href = '/guac/course-details/' + courseId;
		}

		function viewStudents(courseId) {
			window.location.href = '/guac/course-students/' + courseId;
		}

		function viewTeachers(courseId) {
			window.location.href = '/guac/course-teachers/' + courseId;
		}

		function viewSubjects(courseId) {
			window.location.href = '/guac/course-subjects/' + courseId;
		}

		function showSubject(semesterId) {
			window.location.href = '/guac/subjects/semester/' + semesterId;
		}
	</script>
</body>
</html>