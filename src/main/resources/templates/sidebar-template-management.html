<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head th:include="template :: headFragment(${pageTitle})">
<title>[[${pageTitle}]]</title>

<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-multiselect/dist/css/bootstrap-multiselect.css">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">

<style>
:root {
	--primary: #3498db;
	--secondary: #2c3e50;
	--light: #ecf0f1;
	--danger: #e74c3c;
	--success: #2ecc71;
	--warning: #f39c12;
	--info: #17a2b8;
}

body {
	background-color: #f5f7fa;
	font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.card {
	border-radius: 8px;
	box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
	border: none;
}

.card-header {
	background-color: white;
	padding: 20px;
	border-radius: 8px 8px 0 0 !important;
}

.card-title {
	font-weight: 600;
	color: var(--secondary);
}

.form-control {
	border-radius: 6px;
	border: 1px solid #ddd;
	padding: 10px 15px;
}

.btn-primary {
	background-color: var(--primary);
	border-color: var(--primary);
	border-radius: 6px;
	padding: 10px 20px;
	font-weight: 500;
}

.btn-outline-primary {
	border-color: var(--primary);
	color: var(--primary);
	border-radius: 6px;
	padding: 10px 20px;
	font-weight: 500;
}

.btn-outline-primary:hover {
	background-color: var(--primary);
	color: white;
}

.required-field::after {
	content: "*";
	color: var(--danger);
	margin-left: 4px;
}

/* Sidebar Preview Styles */
.sidebar-preview {
	background-color: #f8f9fa;
	border: 1px solid #dee2e6;
	border-radius: 0.375rem;
	max-height: 600px;
	overflow-y: auto;
}

.module-section {
	background-color: #ffffff;
	margin-bottom: 1rem;
	border-radius: 0.375rem;
	box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}

.module-header {
	background-color: #e9ecef;
	padding: 0.75rem 1rem;
	border-bottom: 1px solid #dee2e6;
	font-weight: 600;
	color: #495057;
}

.menu-items {
	padding: 1rem;
}

.menu-item {
	margin-bottom: 0.5rem;
	padding: 0.5rem;
	border-radius: 0.25rem;
	transition: background-color 0.15s ease-in-out;
}

.menu-item:hover {
	background-color: #f8f9fa;
}

.form-check-input:checked+.form-check-label {
	font-weight: 600;
	color: #0d6efd;
}

.template-section {
	background-color: #ffffff;
	border: 1px solid #dee2e6;
	border-radius: 0.375rem;
	padding: 1.5rem;
}

/* Fix for multiselect dropdowns */
.multiselect-container {
	z-index: 1050 !important;
}

.btn-group {
	width: 100%;
}

.multiselect {
	text-align: left;
	width: 100%;
}

.hidden {
	display: none;
}

/* New layout styles */
.template-name-row {
	margin-bottom: 2rem;
}

.sidebar-content-row {
	margin-bottom: 2rem;
}

.submit-row {
	margin-top: 2rem;
	padding-top: 1rem;
	border-top: 1px solid #dee2e6;
}

/* Role Filter Styles */
.role-filter-section {
	background-color: #ffffff;
	border: 1px solid #dee2e6;
	border-radius: 0.375rem;
	padding: 1.5rem;
	margin-bottom: 1.5rem;
}

.role-badge {
	font-size: 0.75rem;
	padding: 0.35em 0.65em;
}

.role-superadmin {
	background-color: #dc3545;
	color: white;
}

.role-admin {
	background-color: #0d6efd;
	color: white;
}

.role-hod {
	background-color: #6f42c1;
	color: white;
}

.role-teacher {
	background-color: #fd7e14;
	color: white;
}

.role-user {
	background-color: #20c997;
	color: white;
}

.role-all {
	background-color: #6c757d;
	color: white;
}

/* Role-based filtering */
.role-filter-option {
	cursor: pointer;
	transition: all 0.2s ease;
}

.role-filter-option:hover {
	transform: translateY(-2px);
	box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.role-filter-option.active {
	border: 2px solid var(--primary);
}

/* Menu item role indicators */
.menu-role-indicators {
	display: flex;
	gap: 5px;
	margin-top: 5px;
}

.menu-role-indicator {
	width: 8px;
	height: 8px;
	border-radius: 50%;
	display: inline-block;
}

.menu-role-superadmin {
	background-color: #dc3545;
}

.menu-role-admin {
	background-color: #0d6efd;
}

.menu-role-hod {
	background-color: #6f42c1;
}

.menu-role-teacher {
	background-color: #fd7e14;
}

.menu-role-user {
	background-color: #20c997;
}

/* Counter badges */
.counter-badge {
	font-size: 0.7rem;
	padding: 0.25em 0.5em;
	margin-left: 5px;
}

/* Responsive adjustments */
@media ( max-width : 768px) {
	.menu-item {
		margin-bottom: 1rem;
	}
	.role-filter-options {
		flex-direction: column;
	}
}
</style>
</head>
<body class="hold-transition sidebar-mini layout-fixed">
	<div class="wrapper">

		<div th:replace="fragments/header :: header"></div>
		<div th:replace="fragments/sidebar :: aside"></div>

		<div class="content-wrapper">
			<section class="content-header">
				<div class="container-fluid">
					<div class="row mb-2">
						<div class="col-sm-6">
							<h1>Sidebar Template Management</h1>
						</div>
						<div class="col-sm-6">
							<ol class="breadcrumb float-sm-right">
								<li class="breadcrumb-item"><a href="#"><i
										class="fas fa-home"></i> Home</a></li>
								<li class="breadcrumb-item active">Sidebar Templates</li>
							</ol>
						</div>
					</div>
				</div>
			</section>

			<section class="content">
				<div class="container-fluid">
					<!-- Success/Error Messages -->
					<div th:if="${success}"
						class="alert alert-success alert-dismissible fade show"
						role="alert">
						<span th:text="${success}"></span>
						<button type="button" class="btn-close" data-bs-dismiss="alert"
							aria-label="Close"></button>
					</div>
					<div th:if="${error}"
						class="alert alert-danger alert-dismissible fade show"
						role="alert">
						<span th:text="${error}"></span>
						<button type="button" class="btn-close" data-bs-dismiss="alert"
							aria-label="Close"></button>
					</div>

					<div class="row justify-content-center">
						<div class="col-md-12">
							<div class="card card-secondary">
								<div class="card-header">
									<div class="row">
										<div class="col-md-10">
											<h3 class="card-title">
												<i class="fas fa-sliders-h"></i> Sidebar Template Management
											</h3>
										</div>
									</div>
								</div>

								<div class="card-body">
									<form th:action="@{/guac/sidebar-templates-save}" method="post"
										id="templateForm">
										<!-- First Row: Template Name -->
										<div class="row template-name-row">
											<div class="col-md-12">
												<div class="template-section">
													<h5 class="mb-3">
														<i class="fas fa-plus-circle me-2"></i>Template
														Information
													</h5>
													<div class="row">
														<div class="col-md-6">
															<div class="form-group">
																<label for="templateName"
																	class="form-label required-field">Template Name</label>
																<input type="text" class="form-control"
																	id="templateName" name="templateName"
																	th:value="${templateName}" required
																	placeholder="Enter template name"> <small
																	class="form-text text-muted">Enter a unique
																	name for your sidebar template</small>
															</div>
														</div>
														<div class="col-md-6">
															<div class="form-group">
																<label class="form-label">Instructions</label>
																<div class="alert alert-info">
																	<small> <i class="fas fa-info-circle me-2"></i>
																		Select the menu items you want to include in this
																		template by checking the boxes below. Use the role
																		filter to show only relevant menu items for specific
																		user roles.
																	</small>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>

										<!-- Role Filter Section -->
										<div class="row">
											<div class="col-md-12">
												<div class="role-filter-section">
													<h5 class="mb-3">
														<i class="fas fa-filter me-2"></i>Filter Menu Items by
														Role
													</h5>
													<div class="alert alert-light">
														<small> <i class="fas fa-lightbulb me-2"></i>
															Select a role to filter menu items. This helps create
															templates tailored to specific user types.
														</small>
													</div>
													<div class="row role-filter-options">
														<!-- 														<div class="col-md-2 mb-3"> -->
														<!-- 															<div class="card role-filter-option active" data-role="all"> -->
														<!-- 																<div class="card-body text-center p-3"> -->
														<!-- 																	<i class="fas fa-users fa-2x mb-2"></i> -->
														<!-- 																	<h6 class="card-title">All Roles</h6> -->
														<!-- 																	<span class="badge role-badge role-all">All</span> -->
														<!-- 																</div> -->
														<!-- 															</div> -->
														<!-- 														</div> -->
														<div class="col-md-2 mb-3">
															<div class="card role-filter-option"
																data-role="superadmin">
																<div class="card-body text-center p-3">
																	<i class="fas fa-crown fa-2x mb-2"></i>
																	<h6 class="card-title">SuperAdmin</h6>
																	<span class="badge role-badge role-superadmin">SuperAdmin</span>
																</div>
															</div>
														</div>
														<div class="col-md-2 mb-3">
															<div class="card role-filter-option" data-role="admin">
																<div class="card-body text-center p-3">
																	<i class="fas fa-user-shield fa-2x mb-2"></i>
																	<h6 class="card-title">Admin</h6>
																	<span class="badge role-badge role-admin">Admin</span>
																</div>
															</div>
														</div>
														<div class="col-md-2 mb-3">
															<div class="card role-filter-option" data-role="hod">
																<div class="card-body text-center p-3">
																	<i class="fas fa-user-tie fa-2x mb-2"></i>
																	<h6 class="card-title">HOD</h6>
																	<span class="badge role-badge role-hod">HOD</span>
																</div>
															</div>
														</div>
														<div class="col-md-2 mb-3">
															<div class="card role-filter-option" data-role="teacher">
																<div class="card-body text-center p-3">
																	<i class="fas fa-chalkboard-teacher fa-2x mb-2"></i>
																	<h6 class="card-title">Teacher</h6>
																	<span class="badge role-badge role-teacher">Teacher</span>
																</div>
															</div>
														</div>
														<div class="col-md-2 mb-3">
															<div class="card role-filter-option" data-role="user">
																<div class="card-body text-center p-3">
																	<i class="fas fa-user-graduate fa-2x mb-2"></i>
																	<h6 class="card-title">User</h6>
																	<span class="badge role-badge role-user">User</span>
																</div>
															</div>
														</div>
													</div>
													<div class="row mt-3">
														<div class="col-md-12">
															<div
																class="d-flex justify-content-between align-items-center">
																<div>
																	<span class="text-muted">Showing: <span
																		id="currentRoleFilter">All Roles</span></span> <span
																		class="badge bg-primary counter-badge"
																		id="menuItemCount">0 items</span>
																</div>
																<button type="button"
																	class="btn btn-outline-primary btn-sm"
																	id="resetRoleFilter">
																	<i class="fas fa-sync-alt me-1"></i>Reset Filter
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>

										<!-- Second Row: Sidebar Menu Items -->
										<div class="row sidebar-content-row">
											<div class="col-md-12">
												<div class="sidebar-preview">
													<div class="p-3 border-bottom bg-light">
														<div
															class="d-flex justify-content-between align-items-center">
															<div>
																<h5 class="mb-0">
																	<i class="fas fa-eye me-2"></i>Sidebar Menu Items
																</h5>
																<small class="text-muted">Select menu items to
																	include in your template</small>
															</div>
															<div class="d-flex align-items-center">
																<div class="form-check form-switch me-3">
																	<input class="form-check-input" type="checkbox"
																		id="showRoleIndicators" checked> <label
																		class="form-check-label" for="showRoleIndicators">
																		<small>Show role indicators</small>
																	</label>
																</div>
																<button type="button"
																	class="btn btn-outline-secondary btn-sm"
																	id="expandAllModules">
																	<i class="fas fa-expand me-1"></i>Expand All
																</button>
															</div>
														</div>
													</div>

													<div class="p-3">
														<div th:each="module : ${menusByModule}"
															class="module-section">
															<div
																class="module-header d-flex justify-content-between align-items-center">
																<div>
																	<i class="fas fa-folder me-2"></i> <span
																		th:text="${module.key}">Module Name</span> <span
																		class="badge bg-secondary counter-badge module-item-count"
																		th:text="${module.value.size()}">0</span>
																</div>
																<button type="button"
																	class="btn btn-sm btn-outline-secondary toggle-module">
																	<i class="fas fa-chevron-down"></i>
																</button>
															</div>
															<div class="menu-items">
																<div class="row">
																	<div th:each="menu : ${module.value}"
																		class="col-md-4 col-lg-3 menu-item"
																		th:id="'menu-item-' + ${menu.menuId}">
																		<div class="form-check">
																			<input class="form-check-input" type="checkbox"
																				th:id="'menu_' + ${menu.menuId}" th:name="menuIds"
																				th:value="${menu.menuId}"> <label
																				class="form-check-label"
																				th:for="'menu_' + ${menu.menuId}"> <span
																				th:text="${menu.subModuleName} ?: 'Unnamed Item'">Sub
																					Module</span> <!-- 																				<small th:if="${menu.url}" class="text-muted d-block" th:text="${menu.url}">URL</small> -->
																				<div class="menu-role-indicators">
																					<span
																						class="menu-role-indicator menu-role-superadmin"
																						title="SuperAdmin"></span> <span
																						class="menu-role-indicator menu-role-admin"
																						title="Admin"></span> <span
																						class="menu-role-indicator menu-role-hod"
																						title="HOD"></span> <span
																						class="menu-role-indicator menu-role-teacher"
																						title="Teacher"></span> <span
																						class="menu-role-indicator menu-role-user"
																						title="User"></span>
																				</div>
																			</label>
																		</div>
																	</div>
																</div>
															</div>
														</div>

														<div th:if="${menusByModule.isEmpty()}"
															class="text-center text-muted py-4">
															<i class="fas fa-inbox fa-2x mb-2"></i>
															<p>No menu items found</p>
														</div>
													</div>
												</div>
											</div>
										</div>

										<!-- Third Row: Submit Buttons -->
										<div class="row submit-row">
											<div class="col-md-12">
												<div
													class="d-flex justify-content-between align-items-center">
													<button type="button" class="btn btn-outline-secondary"
														onclick="clearSelection()">
														<i class="fas fa-times me-2"></i>Clear All Selection
													</button>
													<div>
														<button type="button"
															class="btn btn-outline-secondary me-2"
															onclick="selectAll()">
															<i class="fas fa-check-square me-2"></i>Select All
														</button>
														<button type="submit" class="btn btn-primary">
															<i class="fas fa-save me-2"></i>Save Template
														</button>
													</div>
												</div>
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>
		<div th:replace="fragments/footer :: footer"></div>
	</div>

	<div th:replace="template :: jsscript"></div>

	<!-- Load jQuery first -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<!-- Bootstrap JS -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<!-- Then load Bootstrap Multiselect -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap-multiselect/dist/js/bootstrap-multiselect.min.js"></script>

	<script type="text/javascript">
		// Hardcoded role-based menu data based on your database entries
		const menuRoles = {
			// Master Module (menu_id 1-10, 51)
// 			1: ['superadmin', 'admin'], // Group Master
// 			2: ['superadmin', 'admin'], // Location Master
// 			3: ['superadmin', 'admin'], // Category
// 			4: ['superadmin', 'admin'], // Discount Master
// 			5: ['superadmin', 'admin'], // Mail Master
// 			6: ['superadmin', 'admin'], // Physical Server Master
// 			7: ['superadmin', 'admin'], // VM Location Path Master
// 			8: ['superadmin', 'admin'], // Switch
// 			9: ['superadmin', 'admin'], // Discover
// 			10: ['superadmin', 'admin'], // Billing
// 			51: ['superadmin', 'admin'], // Manage Scope


			1: ['superadmin'], // Group Master
			2: ['superadmin'], // Location Master
			3: ['superadmin'], // Category
			4: ['superadmin'], // Discount Master
			5: ['superadmin'], // Mail Master
			6: ['superadmin'], // Physical Server Master
			7: ['superadmin'], // VM Location Path Master
			8: ['superadmin'], // Switch
			9: ['superadmin'], // Discover
			10: ['superadmin'], // Billing
			51: ['superadmin'], // Manage Scope
			
			// Dashboard Module (menu_id 11)
			11: ['superadmin'], // SuperAdmin Dashboard
			
			// Templates Module (menu_id 12-13)
// 			12: ['superadmin', 'admin'], // Create Template
// 			13: ['superadmin', 'admin'], // View Template

12: ['superadmin'], // Create Template
			13: ['superadmin'], // View Template
			
			// Scenarios Module (menu_id 14-15)
// 			14: ['superadmin', 'admin', 'teacher'], // Create Scenario
// 			15: ['superadmin', 'admin', 'teacher', 'user'], // View Scenario

			14: ['superadmin'], // Create Scenario
			15: ['superadmin'], // View Scenario
			
			// Playlists Module (menu_id 16-17)
// 			16: ['superadmin', 'admin', 'teacher'], // Create Playlist
// 			17: ['superadmin', 'admin', 'teacher', 'user'], // View Playlist

			16: ['superadmin'], // Create Playlist
			17: ['superadmin'], // View Playlist
			
			// Sub-Playlists Module (menu_id 18-19)
// 			18: ['superadmin', 'admin', 'teacher'], // Create Sub Playlist
// 			19: ['superadmin', 'admin', 'teacher', 'user'], // View Sub Playlist

			18: ['superadmin'], // Create Sub Playlist
			19: ['superadmin'], // View Sub Playlist
			
			// Scenario Mapping Module (menu_id 20-22)
// 			20: ['superadmin', 'admin', 'teacher'], // Map Scenario in Sub-Playlist
// 			21: ['superadmin', 'admin', 'teacher'], // Map Scenario & Sub-Playlist In Playlist
// 			22: ['superadmin', 'admin', 'teacher'], // Map Scenario to Subject

			20: ['superadmin'], // Map Scenario in Sub-Playlist
			21: ['superadmin'], // Map Scenario & Sub-Playlist In Playlist
			22: ['superadmin'], // Map Scenario to Subject
			
			// In Progress Task Module (menu_id 23-24)
// 			23: ['superadmin', 'admin', 'teacher', 'user'], // My Scenario Inprogress
// 			24: ['superadmin', 'admin', 'teacher', 'user'], // My Scenario Completed

			23: ['superadmin'], // My Scenario Inprogress
			24: ['superadmin'], // My Scenario Completed
			
			// Docker Management Module (menu_id 25-28)
// 			25: ['superadmin', 'admin'], // Discover Docker
// 			26: ['superadmin', 'admin'], // Create Docker Network
// 			27: ['superadmin', 'admin'], // View Docker Network
// 			28: ['superadmin', 'admin'], // View Discover Container

	25: ['superadmin'], // Discover Docker
			26: ['superadmin'], // Create Docker Network
			27: ['superadmin'], // View Docker Network
			28: ['superadmin'], // View Discover Container
			
			// Teacher Module (menu_id 29, 53)
			29: ['teacher'], // Teacher Dashboard
			53: ['teacher'], // Home-Teacher
			
			// User Module (menu_id 30-36, 52)
			30: ['user'], // User Dashboard
			31: ['user'], // View User Playlist
			32: ['user'], // View User Sub Playlist
			33: ['user'], // View User Scenario
			34: ['user'], // My User Scenario Inprogress
			35: ['user'], // My User Scenario Completed
			36: ['user'], // Task Performance
			52: ['user'], // Home-User
			
			// User Management Module (menu_id 37-38)
// 			37: ['superadmin', 'admin'], // Users
// 			38: ['superadmin', 'admin'], // Teachers

			37: ['superadmin'], // Users
			38: ['superadmin'], // Teachers
			
			// University Management Module (menu_id 39-44)
// 			39: ['superadmin', 'admin', 'hod'], // Department
// 			40: ['superadmin', 'admin', 'hod'], // Course
// 			41: ['superadmin', 'admin', 'hod'], // Semester
// 			42: ['superadmin', 'admin', 'hod'], // Subject
// 			43: ['superadmin', 'admin', 'hod'], // Add Batch
// 			44: ['superadmin', 'admin', 'hod'], // View Batch

// now this will showcase to only to superAdmin if want to show case to other filed like hod,Admin then add here there role
			39: ['superadmin'], // Department
			40: ['superadmin'], // Course
			41: ['superadmin'], // Semester
			42: ['superadmin'], // Subject
			43: ['superadmin'], // Add Batch
			44: ['superadmin'], // View Batch
			
			// Role Management Module (menu_id 45)
// 			45: ['superadmin', 'admin'], // Assign Role

			45: ['superadmin'], // Assign Role
			
			// Performance Management Module (menu_id 46)
// 			46: ['superadmin', 'admin', 'hod', 'teacher'], // User Wise Performance

			46: ['superadmin'], // User Wise Performance
			
			// Lab Management Module (menu_id 47)
// 			47: ['superadmin', 'admin'], // Labs

			47: ['superadmin'], // Labs
			
			// Price Master Module (menu_id 48)
// 			48: ['superadmin', 'admin'], // View Price

			48: ['superadmin'], // View Price
			
			// Product Master Module (menu_id 49-50)
// 			49: ['superadmin', 'admin'], // Product Master
// 			50: ['superadmin', 'admin'], // Sub Product Master

			49: ['superadmin'], // Product Master
			50: ['superadmin'], // Sub Product Master
			
			// Hod Module (menu_id 54-55)
			54: ['hod'], // Home-Hod
			55: ['hod'], // Dashboard-Hod
			
			// Admin Module (menu_id 56-57)
			56: ['admin'], // Dashboard-Admin
			57: ['admin'] // Home-Admin
		};

		// Current active role filter
		let currentRoleFilter = 'all';
		
		// Initialize the page
		document.addEventListener('DOMContentLoaded', function() {
			initializeRoleFilters();
			updateRoleIndicators();
			updateMenuItemCount();
			setupModuleToggles();
		});

		// Initialize role filter functionality
		function initializeRoleFilters() {
			// Set up role filter cards
			const roleFilterOptions = document.querySelectorAll('.role-filter-option');
			roleFilterOptions.forEach(option => {
				option.addEventListener('click', function() {
					// Remove active class from all options
					roleFilterOptions.forEach(opt => opt.classList.remove('active'));
					
					// Add active class to clicked option
					this.classList.add('active');
					
					// Get the selected role
					const selectedRole = this.getAttribute('data-role');
					currentRoleFilter = selectedRole;
					
					// Update the current role filter display
					document.getElementById('currentRoleFilter').textContent = 
						selectedRole === 'all' ? 'All Roles' : 
						selectedRole.charAt(0).toUpperCase() + selectedRole.slice(1);
					
					// Filter menu items
					filterMenuItemsByRole(selectedRole);
					
					// Update menu item count
					updateMenuItemCount();
				});
			});
			
			// Set up reset filter button
			document.getElementById('resetRoleFilter').addEventListener('click', function() {
				// Reset to "All Roles"
				const allRolesOption = document.querySelector('.role-filter-option[data-role="all"]');
				allRolesOption.click();
			});
			
			// Set up role indicators toggle
			document.getElementById('showRoleIndicators').addEventListener('change', function() {
				const indicators = document.querySelectorAll('.menu-role-indicators');
				if (this.checked) {
					indicators.forEach(indicator => indicator.style.display = 'flex');
				} else {
					indicators.forEach(indicator => indicator.style.display = 'none');
				}
			});
			
			// Set up expand all modules button
			document.getElementById('expandAllModules').addEventListener('click', function() {
				const moduleSections = document.querySelectorAll('.module-section');
				const isExpanded = this.getAttribute('data-expanded') === 'true';
				
				moduleSections.forEach(section => {
					const menuItems = section.querySelector('.menu-items');
					const toggleBtn = section.querySelector('.toggle-module');
					
					if (isExpanded) {
						// Collapse
						menuItems.style.display = 'none';
						toggleBtn.innerHTML = '<i class="fas fa-chevron-down"></i>';
					} else {
						// Expand
						menuItems.style.display = 'block';
						toggleBtn.innerHTML = '<i class="fas fa-chevron-up"></i>';
					}
				});
				
				// Update button state and text
				this.setAttribute('data-expanded', !isExpanded);
				this.innerHTML = isExpanded ? 
					'<i class="fas fa-expand me-1"></i>Expand All' : 
					'<i class="fas fa-compress me-1"></i>Collapse All';
			});
		}
		
		// Filter menu items by role
// 		function filterMenuItemsByRole(role) {
// 			const menuItems = document.querySelectorAll('.menu-item');
			
// 			menuItems.forEach(item => {
// 				const menuId = parseInt(item.id.replace('menu-item-', ''));
// 				const roles = menuRoles[menuId] || [];
				
// 				if (role === 'all' || role === 'superadmin' || roles.includes(role)) {
// 					item.style.display = 'block';
// 				} else {
// 					item.style.display = 'none';
// 				}
// 			});
			
// 			// Update module item counts
// 			updateModuleItemCounts();
// 		}
		
		
		  function filterMenuItemsByRole(role) {
            const menuItems = document.querySelectorAll('.menu-item');
            
            menuItems.forEach(item => {
                const menuId = parseInt(item.id.replace('menu-item-', ''));
                const roles = menuRoles[menuId] || [];
                
                if (role === 'all') {
                    // Show all items for "All Roles"
                    item.style.display = 'block';
                } else if (role === 'superadmin') {
                    // SuperAdmin can see all items
                    item.style.display = 'block';
                } else {
                    // For other roles, only show items that belong to that specific role
                    if (roles.includes(role)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                }
            });
            
            // Update module item counts
            updateModuleItemCounts();
        }
		
		// Update role indicators for each menu item
		function updateRoleIndicators() {
			const menuItems = document.querySelectorAll('.menu-item');
			
			menuItems.forEach(item => {
				const menuId = parseInt(item.id.replace('menu-item-', ''));
				const roles = menuRoles[menuId] || [];
				const indicators = item.querySelectorAll('.menu-role-indicator');
				
				// Hide all indicators initially
				indicators.forEach(indicator => {
					indicator.style.opacity = '0.2';
				});
				
				// Show indicators for roles that have access
				roles.forEach(role => {
					const indicator = item.querySelector(`.menu-role-${role}`);
					if (indicator) {
						indicator.style.opacity = '1';
					}
				});
			});
		}
		
		// Update the menu item count display
		function updateMenuItemCount() {
			const visibleItems = document.querySelectorAll('.menu-item[style="display: block"]').length;
			const totalItems = document.querySelectorAll('.menu-item').length;
			
			document.getElementById('menuItemCount').textContent = 
				currentRoleFilter === 'all' ? 
				`${totalItems} items` : 
				`${visibleItems} of ${totalItems} items`;
		}
		
		// Update module item counts after filtering
		function updateModuleItemCounts() {
			const moduleSections = document.querySelectorAll('.module-section');
			
			moduleSections.forEach(section => {
				const visibleItems = section.querySelectorAll('.menu-item[style="display: block"]').length;
				const totalItems = section.querySelectorAll('.menu-item').length;
				const counterBadge = section.querySelector('.module-item-count');
				
				if (counterBadge) {
					counterBadge.textContent = currentRoleFilter === 'all' ? 
						`${totalItems}` : 
						`${visibleItems}/${totalItems}`;
				}
			});
		}
		
		// Set up module toggle functionality
		function setupModuleToggles() {
			const toggleButtons = document.querySelectorAll('.toggle-module');
			
			toggleButtons.forEach(button => {
				button.addEventListener('click', function() {
					const moduleSection = this.closest('.module-section');
					const menuItems = moduleSection.querySelector('.menu-items');
					
					if (menuItems.style.display === 'none') {
						menuItems.style.display = 'none';
						this.innerHTML = '<i class="fas fa-chevron-up"></i>';
					} else {
						menuItems.style.display = 'none';
						this.innerHTML = '<i class="fas fa-chevron-down"></i>';
					}
				});
			});
		}

		function clearSelection() {
			const checkboxes = document.querySelectorAll('input[name="menuIds"]');
			checkboxes.forEach(checkbox => {
				checkbox.checked = false;
			});
		}

		function selectAll() {
			const checkboxes = document.querySelectorAll('input[name="menuIds"]');
			checkboxes.forEach(checkbox => {
				checkbox.checked = true;
			});
		}

		// Form submission handling
		document.getElementById('templateForm').addEventListener('submit', function(e) {
			const selectedMenus = document.querySelectorAll('input[name="menuIds"]:checked');
			const templateName = document.getElementById('templateName').value.trim();
			
			if (!templateName) {
				e.preventDefault();
				alert('Please enter a template name');
				return;
			}
			
			if (selectedMenus.length === 0) {
				e.preventDefault();
				alert('Please select at least one menu item');
				return;
			}
		});
	</script>
</body>
</html>