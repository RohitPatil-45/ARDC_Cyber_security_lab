<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>Cloud Portal</title>
<head th:include="templateListing :: headFragment"></head>
<link rel="icon" type="image/png"
	href="/webtemplate/dist/img/magicboxEye3.png">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/fontawesome-free/css/all.min.css}">
<!-- Ionicons -->
<link rel="stylesheet" th:href="@{/css/ionicIcons.css}">
<!-- Tempusdominus Bootstrap 4 -->
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css}">
<!-- iCheck -->
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/icheck-bootstrap/icheck-bootstrap.min.css}">
<!-- JQVMap -->
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/jqvmap/jqvmap.min.css}">
<!-- Theme style -->
<link rel="stylesheet"
	th:href="@{/webtemplate/dist/css/adminlte.min.css}">
<!-- overlayScrollbars -->
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/overlayScrollbars/css/OverlayScrollbars.min.css}">
<!-- Daterange picker -->
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/daterangepicker/daterangepicker.css}">
<!-- summernote -->
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/summernote/summernote-bs4.min.css}">
<link rel="stylesheet" type="text/css"
	th:href="@{/webtemplate/plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css}">

<!--End Common CSS  -->

<!-- <link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">  -->
<link rel="stylesheet"
	th:href="@{/webtemplate/css/cloudfont-awesome.min.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/css/font-awesome.min.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/select2/css/select2.min.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/datatables-responsive/css/responsive.bootstrap4.min.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/datatables-buttons/css/buttons.bootstrap4.min.css}">
<style>
/* Add a custom style for the Action button to make it look nice */
.action-btn {
	background-color: #007bff;
	color: white;
	border: none;
	padding: 8px 12px;
	border-radius: 4px;
	cursor: pointer;
	transition: background-color 0.3s ease;
}

.action-btn:hover {
	background-color: #0056b3;
}

/* Style for the modal and progress bar */
.progress-container {
	height: 25px;
	background-color: #e9ecef;
	border-radius: 5px;
	margin-top: 10px;
}

.progress-bar {
	background-color: #28a745;
	transition: width 0.6s ease;
}
</style>
</head>
<body class="hold-transition sidebar-mini layout-fixed">
	<div class="wrapper">
		<div th:replace="fragments/header :: header"></div>
		<div th:replace="fragments/sidebar :: aside"></div>

		<div class="content-wrapper">
			<section class="content-header">
				<div class="container-fluid">
					<div class="row mb-2">
						<div class="col-sm-6">
							<h1>User Wise Performance</h1>
						</div>
						<div class="col-sm-6">
							<ol class="breadcrumb float-sm-right">
								<li class="breadcrumb-item"><a href="#">Home</a></li>
								<li class="breadcrumb-item active">User Wise Performance</li>
							</ol>
						</div>
					</div>
				</div>
			</section>

			<section class="content">
				<div class="container-fluid">
					<div class="row">
						<div class="col-12">
							<div class="card card-secondary">
								<div class="card-header">
									<h3 class="card-title" style="padding-top: 10px">User
										Performance Details</h3>
								</div>
								<div class="card-body">
									<table id="userPerformanceTable"
										class="table table-bordered table-striped">
										<thead class="thead-light">
											<tr>
												<th>Sr No.</th>
												<th>User Name</th>
												<th>Performance %</th>
												<th>Action</th>
											</tr>
										</thead>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>

		<div th:replace="fragments/footer :: footer"></div>
	</div>



	<div class="modal fade" id="performanceModal" tabindex="-1"
		aria-labelledby="performanceModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-lg">
			<!-- Added modal-lg -->
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="performanceModalLabel">
						Scenario Performance for <span id="modalUsername"></span>
					</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body" id="modalBodyContent">
					<!-- Table will be inserted here -->
					<table id="modalScenarioTable"
						class="table table-bordered table-striped w-100">
						<thead>
							<tr>
								<th>Sr No.</th>
								<th>Scenario Name</th>
								<th>Progress %</th>
							</tr>
						</thead>
						<tbody></tbody>
					</table>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>


	<div th:replace="templateListing :: jsscript"></div>

	<!-- Common JS  -->
	<!-- jQuery -->
	<script th:src="@{/webtemplate/plugins/jquery/jquery.min.js}"></script>
	<!-- jQuery UI 1.11.4 -->
	<script th:src="@{/webtemplate/plugins/jquery-ui/jquery-ui.min.js}"></script>

	<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
	<script>
		$.widget.bridge('uibutton', $.ui.button)
	</script>
	<!-- Bootstrap 4 -->
	<script
		th:src="@{/webtemplate/plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
	<!-- ChartJS -->
	<script th:src="@{/webtemplate/plugins/chart.js/Chart.min.js}"></script>
	<!-- Sparkline -->
	<!-- 	<script th:src="@{/webtemplate/plugins/sparklines/sparkline.js}"></script> -->
	<!-- JQVMap -->
	<!-- <script th:src="@{/webtemplate/plugins/jqvmap/jquery.vmap.min.js}"></script>
	<script th:src="@{/webtemplate/plugins/jqvmap/maps/jquery.vmap.usa.js}"></script> -->
	<!-- jQuery Knob Chart -->
	<script th:src="@{/webtemplate/plugins/jquery-knob/jquery.knob.min.js}"></script>
	<!-- daterangepicker -->
	<script th:src="@{/webtemplate/plugins/moment/moment.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/daterangepicker/daterangepicker.js}"></script>
	<!-- Tempusdominus Bootstrap 4 -->
	<script
		th:src="@{/webtemplate/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js}"></script>
	<!-- Summernote -->
	<script
		th:src="@{/webtemplate/plugins/summernote/summernote-bs4.min.js}"></script>
	<!-- overlayScrollbars -->
	<script
		th:src="@{/webtemplate/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js}"></script>
	<!-- AdminLTE App -->
	<script th:src="@{/webtemplate/dist/js/adminlte.js}"></script>
	<!-- AdminLTE for demo purposes -->
	<script th:src="@{/webtemplate/dist/js/demo.js}"></script>
	<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
	<!-- <script th:src="@{/webtemplate/dist/js/pages/dashboard.js}"></script> -->
	<!--End Common JS  -->

	<script
		th:src="@{/webtemplate/plugins/jquery-validation/jquery.validate.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/jquery-validation/additional-methods.min.js}"></script>
	<script th:src="@{/webtemplate/plugins/sweetalert2/sweetalert2.min.js}"></script>
	<script th:src="@{/webtemplate/plugins/select2/js/select2.full.min.js}"></script>

	<script
		th:src="@{/webtemplate/plugins/datatables/jquery.dataTables.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-responsive/js/dataTables.responsive.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-responsive/js/responsive.bootstrap4.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-buttons/js/dataTables.buttons.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-buttons/js/buttons.bootstrap4.min.js}"></script>
	<script th:src="@{/webtemplate/plugins/jszip/jszip.min.js}"></script>
	<script th:src="@{/webtemplate/plugins/pdfmake/pdfmake.min.js}"></script>
	<script th:src="@{/webtemplate/plugins/pdfmake/vfs_fonts.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-buttons/js/buttons.html5.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-buttons/js/buttons.print.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-buttons/js/buttons.colVis.min.js}"></script>
	<script th:src="@{/webtemplate/plugins/sweetalert2/sweetalert2.min.js}"></script>

	<script th:inline="javascript">
    let rawData = [[${listObj}]]; // âœ… not inside quotes
    let jsonData = [];

    try {
        jsonData = (typeof rawData === "string") ? JSON.parse(rawData) : rawData;
    } catch (e) {
        console.error("Invalid JSON data for UserWisePerformance:", e);
    }

    $("#userPerformanceTable").DataTable({
        data: jsonData,
        responsive: false,
        lengthChange: false,
        autoWidth: false,
        buttons: ["csv", "excel", "print", "colvis"]
    }).buttons().container().appendTo('#userPerformanceTable_wrapper .col-md-6:eq(0)');
</script>


	<script>
	

	function getuserPerformance(username) {
	    const modal = $("#performanceModal");
	    modal.find("#modalUsername").text(username);

	    // Show the modal (Bootstrap 5)
	    const bsModal = new bootstrap.Modal(document.getElementById('performanceModal'));
	    bsModal.show();

	    // Destroy existing DataTable before reinitializing
	    if ($.fn.DataTable.isDataTable("#modalScenarioTable")) {
	        $('#modalScenarioTable').DataTable().clear().destroy();
	    }

	    // Show loading
	    $("#modalScenarioTable tbody").html("<tr><td colspan='3'>Loading...</td></tr>");

	    $.ajax({
	        url: '/guac/getScenarioByUsername',
	        type: 'GET',
	        dataType: "json",
	        data: { username: username },
	        success: function (data) {
	        	alert("data : "+data)
	            $('#modalScenarioTable').DataTable({
	                data: data,
	                responsive: true,
	                lengthChange: false,
	                autoWidth: false,
	                buttons: ["csv", "excel", "print", "colvis"]
	            }).buttons().container().appendTo('#modalScenarioTable_wrapper .col-md-6:eq(0)');
	        },
	        error: function () {
	            $("#modalScenarioTable tbody").html("<tr><td colspan='3' class='text-danger'>Failed to load scenario data.</td></tr>");
	        }
	    });
	}

</script>

</body>
</html>