<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head th:include="template :: headFragment(${pageTitle})">
<title>Assessment Lab | Cyber Ranges</title>

<!-- Fonts & Icons -->
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link
	href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500;700&display=swap"
	rel="stylesheet">

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Bootstrap CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">

<!-- Chart.js for percentage graphs -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<style>
:root {
	--primary-blue: #2b7fff;
	--blue-dark: #1a5dd0;
	--blue-light: #3d8aff;
	--bg-light: #f8f9fa;
	--bg-card: #ffffff;
	--bg-card-header: #f1f5f9;
	--text-primary: #333333;
	--text-secondary: #666666;
	--border-color: #e0e0e0;
	--success: #00c853;
	--warning: #ffab00;
	--danger: #ff1744;
	--assessment-color: #8a2be2;
	--shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

* {
	box-sizing: border-box;
}

body {
	background-color: var(--bg-light);
	color: var(--text-primary);
	font-family: 'Poppins', sans-serif;
	line-height: 1.6;
	margin: 0;
	padding: 0;
}

.content-wrapper {
	padding: 1.5rem;
	background-color: var(--bg-light);
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
	color: var(--assessment-color);
	font-weight: 600;
	margin-top: 0;
}

h1 {
	font-size: 2rem;
	margin-bottom: 1.5rem;
}

h3 {
	font-size: 1.5rem;
	margin-bottom: 1rem;
}

/* Card Styles */
.card {
	background-color: var(--bg-card);
	border: 1px solid var(--border-color);
	border-radius: 8px;
	box-shadow: var(--shadow);
	margin-bottom: 1.5rem;
	overflow: hidden;
	transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card-header {
	border-bottom: 1px solid var(--border-color);
	background-color: var(--bg-card-header);
	padding: 1rem 1.5rem;
}

.card-title {
	font-weight: 600;
	font-size: 1.25rem;
	color: var(--assessment-color);
	margin: 0;
	display: flex;
	align-items: center;
	gap: 0.5rem;
}

.card-body {
	padding: 1.5rem;
}

/* Timer Styles */
.timer-container {
	background: linear-gradient(135deg, var(--assessment-color), #6a0dad);
	color: white;
	padding: 1rem;
	border-radius: 8px;
	margin-bottom: 1.5rem;
	text-align: center;
	box-shadow: 0 4px 15px rgba(138, 43, 226, 0.3);
}

.timer-label {
	font-size: 0.9rem;
	text-transform: uppercase;
	letter-spacing: 1px;
	margin-bottom: 0.5rem;
	opacity: 0.9;
}

.timer-display {
	font-size: 2.5rem;
	font-weight: 700;
	font-family: 'Roboto Mono', monospace;
	margin: 0;
}

.timer-warning {
	background: linear-gradient(135deg, var(--warning), #ff6b00);
}

.timer-danger {
	background: linear-gradient(135deg, var(--danger), #c40000);
	animation: pulse 1s infinite;
}

@keyframes pulse {
	0% { opacity: 1; }
	50% { opacity: 0.7; }
	100% { opacity: 1; }
}

/* Table Styles */
.table-responsive {
	border-radius: 8px;
	overflow: hidden;
	border: 1px solid var(--border-color);
}

.table {
	margin-bottom: 0;
	color: var(--text-primary);
	background-color: var(--bg-card);
}

.table th {
	background-color: #e9ecef;
	color: #495057;
	font-weight: 600;
	border-bottom: 2px solid var(--border-color);
	padding: 1rem;
	text-transform: uppercase;
	font-size: 0.85rem;
	letter-spacing: 0.5px;
	white-space: nowrap;
}

.table td {
	vertical-align: middle;
	border-color: var(--border-color);
	padding: 1rem;
	background-color: var(--bg-card);
	color: var(--text-primary);
	white-space: nowrap;
}

.table-striped tbody tr:nth-of-type(odd) {
	background-color: #f8f9fa;
}

/* Button Styles */
.btn-assessment {
	background: linear-gradient(to bottom, var(--assessment-color), #6a0dad);
	color: #fff;
	border: none;
	font-weight: 600;
	border-radius: 4px;
	padding: 0.5rem 1.25rem;
	transition: all 0.3s ease;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
	display: inline-flex;
	align-items: center;
	gap: 0.5rem;
}

.btn-assessment:hover {
	background: linear-gradient(to bottom, #7a1be2, #5a0cad);
	transform: translateY(-2px);
	box-shadow: 0 4px 15px rgba(138, 43, 226, 0.3);
}

.btn-start-assessment {
	background: linear-gradient(to bottom, #28a745, #20c997);
	color: #fff;
	border: none;
	font-weight: 600;
	border-radius: 8px;
	padding: 1rem 2rem;
	font-size: 1.1rem;
	transition: all 0.3s ease;
	box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
	display: inline-flex;
	align-items: center;
	gap: 0.75rem;
}

.btn-start-assessment:hover {
	background: linear-gradient(to bottom, #218838, #1e9c7a);
	transform: translateY(-3px);
	box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
}

/* Badge Styles */
.badge {
	font-weight: 600;
	padding: 0.5rem 0.75rem;
	border-radius: 50px;
	font-size: 0.75rem;
}

.badge-assessment {
	background-color: var(--assessment-color);
	color: #fff;
}

.badge-success {
	background-color: var(--success);
}

.badge-warning {
	background-color: var(--warning);
}

.badge-danger {
	background-color: var(--danger);
}

/* Breadcrumb */
.breadcrumb {
	background-color: transparent;
	padding: 0;
	margin-bottom: 1.5rem;
}

.breadcrumb-item a {
	color: var(--assessment-color);
	text-decoration: none;
	transition: color 0.3s ease;
}

.breadcrumb-item.active {
	color: var(--text-secondary);
}

/* Text Section */
.text-section {
	margin-bottom: 2rem;
	padding: 1.5rem;
	background-color: var(--bg-card);
	border-radius: 8px;
	border-left: 4px solid var(--assessment-color);
	box-shadow: var(--shadow);
}

.text-section h1 {
	margin-top: 0;
	font-size: 1.8rem;
}

.text-section p {
	line-height: 1.6;
	margin-bottom: 0.5rem;
	color: var(--text-primary);
}

/* Instructions Section */
.instructions-section {
	background: linear-gradient(135deg, #f8f9fa, #e9ecef);
	border: 2px solid var(--assessment-color);
	border-radius: 12px;
	padding: 2rem;
	margin-bottom: 2rem;
	box-shadow: var(--shadow);
}

.instructions-header {
	text-align: center;
	margin-bottom: 2rem;
}

.instructions-header h2 {
	color: var(--assessment-color);
	font-size: 2rem;
	margin-bottom: 0.5rem;
}

.instructions-header p {
	color: var(--text-secondary);
	font-size: 1.1rem;
}

.instructions-grid {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
	gap: 1.5rem;
	margin-bottom: 2rem;
}

.instruction-item {
	background: white;
	padding: 1.5rem;
	border-radius: 8px;
	border-left: 4px solid var(--assessment-color);
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.instruction-item.warning {
	border-left-color: var(--warning);
	background: #fffbf0;
}

.instruction-item.danger {
	border-left-color: var(--danger);
	background: #fff5f5;
}

.instruction-item.success {
	border-left-color: var(--success);
	background: #f0fff4;
}

.instruction-icon {
	font-size: 2rem;
	margin-bottom: 1rem;
	color: var(--assessment-color);
}

.instruction-item.warning .instruction-icon {
	color: var(--warning);
}

.instruction-item.danger .instruction-icon {
	color: var(--danger);
}

.instruction-item.success .instruction-icon {
	color: var(--success);
}

.instruction-item h4 {
	margin-bottom: 0.75rem;
	color: var(--text-primary);
}

.instruction-item p {
	color: var(--text-secondary);
	margin-bottom: 0;
}

/* Start Button Container */
.start-button-container {
	text-align: center;
	padding: 2rem;
	background: white;
	border-radius: 12px;
	border: 2px dashed var(--assessment-color);
	margin-bottom: 2rem;
}

.start-button-container h3 {
	color: var(--assessment-color);
	margin-bottom: 1rem;
}

.start-button-container p {
	color: var(--text-secondary);
	margin-bottom: 1.5rem;
	font-size: 1.1rem;
}

/* Hidden Sections */
.hidden-section {
	display: none;
}

/* Progress Bar Styles */
.progress-container {
	width: 100%;
	height: 20px;
	background-color: #e9ecef;
	border-radius: 10px;
	overflow: hidden;
	margin: 0.5rem 0;
	position: relative;
}

.progress-bar {
	height: 100%;
	background: linear-gradient(90deg, var(--assessment-color), #9b4dff);
	border-radius: 10px;
	transition: width 0.5s ease;
	position: relative;
}

.progress-text {
	position: absolute;
	right: 10px;
	top: 0;
	font-size: 0.75rem;
	font-weight: 600;
	color: #333;
	text-shadow: none;
	line-height: 20px;
}

/* Status Indicators */
.status-indicator {
	display: inline-block;
	width: 10px;
	height: 10px;
	border-radius: 50%;
	margin-right: 0.5rem;
}

.status-active {
	background-color: var(--success);
}

.status-inactive {
	background-color: var(--danger);
}

.status-pending {
	background-color: var(--warning);
}

/* Action buttons container */
.action-buttons {
	display: flex;
	gap: 0.5rem;
}

/* Empty state styling */
.text-muted {
	color: #6c757d !important;
}

/* Score Summary Section */
.score-summary {
	background: linear-gradient(135deg, #f8f9fa, #e9ecef);
	border-radius: 12px;
	padding: 2rem;
	margin-bottom: 2rem;
	box-shadow: var(--shadow);
	text-align: center;
	border: 2px solid var(--success);
}

.score-header {
	margin-bottom: 1.5rem;
}

.score-header h2 {
	color: var(--success);
	font-size: 2rem;
	margin-bottom: 0.5rem;
}

.score-value {
	font-size: 3rem;
	font-weight: 700;
	color: var(--success);
	margin: 1rem 0;
}

.score-breakdown {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
	gap: 1rem;
	margin-top: 1.5rem;
}

.score-item {
	background: white;
	padding: 1rem;
	border-radius: 8px;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.score-item h4 {
	margin-bottom: 0.5rem;
	color: var(--text-primary);
}

.score-item .score {
	font-size: 1.5rem;
	font-weight: 600;
	color: var(--assessment-color);
}

/* Responsive adjustments */
@media (max-width: 768px) {
	.content-wrapper {
		padding: 1rem;
	}
	
	.card-body {
		padding: 1rem;
	}
	
	.table-responsive {
		font-size: 0.9rem;
	}
	
	.action-buttons {
		flex-direction: column;
	}
	
	.timer-display {
		font-size: 2rem;
	}
	
	.instructions-grid {
		grid-template-columns: 1fr;
	}
	
	.btn-start-assessment {
		width: 100%;
		justify-content: center;
	}
	
	.score-breakdown {
		grid-template-columns: 1fr;
	}
}
</style>
<body class="hold-transition sidebar-mini layout-fixed">
	<div class="wrapper">

		<!-- Header & Sidebar -->
		<div th:replace="fragments/header :: header"></div>
		<div th:replace="fragments/sidebar :: aside"></div>

		<!-- Main Content -->
		<div class="content-wrapper">
			<section class="content-header">
				<div class="container-fluid">
					<div class="row mb-2">
						<div class="col-sm-6">
							<h1>[[${pageTitle}]]</h1>
						</div>
						<div class="col-sm-6">
							<ol class="breadcrumb float-sm-right">
								<li class="breadcrumb-item"><a href="#"><i
										class="fas fa-home"></i> Home</a></li>
								<li class="breadcrumb-item active">Assessment Lab</li>
							</ol>
						</div>
					</div>
				</div>
			</section>

			<!-- Assessment Instructions Section -->
			<div class="row" id="instructionsSection">
				<div class="col-md-12">
					<div class="instructions-section">
						<div class="instructions-header">
							<h2><i class="fas fa-clipboard-check"></i> ASSESSMENT INSTRUCTIONS</h2>
							<p>Please read all instructions carefully before starting your assessment</p>
						</div>
						
						<div class="instructions-grid">
							<div class="instruction-item danger">
								<div class="instruction-icon">
									<i class="fas fa-exclamation-triangle"></i>
								</div>
								<h4>DO NOT Close Browser</h4>
								<p>Closing the browser will terminate your assessment and you may lose your progress.</p>
							</div>
							
							<div class="instruction-item danger">
								<div class="instruction-icon">
									<i class="fas fa-ban"></i>
								</div>
								<h4>DO NOT Switch Tabs</h4>
								<p>Switching to other browser tabs or applications may be considered as suspicious activity.</p>
							</div>
							
							<div class="instruction-item warning">
								<div class="instruction-icon">
									<i class="fas fa-clock"></i>
								</div>
								<h4>Time Limit</h4>
								<p>The assessment has a strict time limit. Once started, the timer cannot be paused or reset.</p>
							</div>
							
							<div class="instruction-item">
								<div class="instruction-icon">
									<i class="fas fa-desktop"></i>
								</div>
								<h4>Single Session</h4>
								<p>You can only take this assessment once. Make sure you have stable internet connection.</p>
							</div>
							
							<div class="instruction-item">
								<div class="instruction-icon">
									<i class="fas fa-save"></i>
								</div>
								<h4>Auto-Save</h4>
								<p>Your progress is automatically saved, but ensure you complete all tasks before time ends.</p>
							</div>
							
							<div class="instruction-item success">
								<div class="instruction-icon">
									<i class="fas fa-check-circle"></i>
								</div>
								<h4>Read Carefully</h4>
								<p>Read all questions and instructions carefully before attempting to answer.</p>
							</div>
						</div>
						
						<div class="start-button-container">
							<h3><i class="fas fa-play-circle"></i> Ready to Begin?</h3>
							<p>Once you click the button below, your assessment timer will start and cannot be paused.</p>
							<p class="text-danger"><strong>Make sure you are ready before proceeding!</strong></p>
							<button id="startAssessmentBtn" class="btn btn-start-assessment">
								<i class="fas fa-play"></i> START ASSESSMENT
							</button>
						</div>
					</div>
				</div>
			</div>

			<!-- Score Summary Section (Initially Hidden) -->
			<div class="row hidden-section" id="scoreSummarySection">
				<div class="col-md-12">
					<div class="score-summary">
						<div class="score-header">
							<h2><i class="fas fa-trophy"></i> ASSESSMENT COMPLETED</h2>
							<p>Congratulations! You have completed all assessment labs.</p>
						</div>
						<div class="score-value" id="totalScore">0%</div>
						<div class="score-breakdown" id="scoreBreakdown">
							<!-- This will be populated dynamically -->
						</div>
					</div>
				</div>
			</div>

			<!-- Assessment Timer (Initially Hidden) -->
			<div class="row hidden-section" id="timerSection">
				<div class="col-md-12">
					<div class="timer-container" id="timerContainer">
<!-- 						<div class="timer-label"> -->
<!-- 							<i class="fas fa-clock"></i> ASSESSMENT TIME REMAINING -->
<!-- 						</div> -->
<!-- 						<div class="timer-display" id="timerDisplay"> -->
<!-- 							[[${assessmentTime}]] -->
<!-- 						</div> -->
					</div>
				</div>
			</div>

			<!-- Assessment Guidelines (Initially Hidden) -->
			<div class="row hidden-section" id="guidelinesSection">
				<div class="col-md-12">
					<div class="text-section">
						<h1>
							<i class="fas fa-clipboard-check"></i> ASSESSMENT IN PROGRESS
						</h1>
						<div class="cyber-line"></div>
						<p><strong>Assessment Active:</strong> Your assessment timer is running. Complete all tasks before time runs out.</p>
						<p><strong>Access Methods:</strong> Browser-based access is provided via web GUI service and SSH for Webshell access.</p>
						<p><strong>Warning:</strong> Do not close this browser window or switch tabs during the assessment.</p>
					</div>
				</div>
			</div>

			<!-- Table and Instructions (Initially Hidden) -->
			<section class="content hidden-section" id="labsSection">
				<div class="container-fluid">
					<div class="row">
						<div class="col-md-12">
							<div class="card">
								<div class="card-header">
									<h3 class="card-title">
										<i class="fas fa-network-wired"></i> Assessment Lab Overview
									</h3>
								</div>
								<div class="card-body table-responsive" id="table-container">
									<table class="table table-bordered table-striped">
										<thead>
											<tr>
												<th>ID</th>
												<th>Lab Name</th>
												<th>IP Address</th>
												<th>UserName</th>
												<th>Password</th>
												<th>OS</th>
												<th>Status</th>
												<th>Progress</th>
												<th>State</th>
												<th>Console</th>
											</tr>
										</thead>
										<tbody>
											<th:block th:if="${labData != null and !labData.empty}">
												<tr th:each="data : ${labData}">
													<td th:text="${data['lab'].labId}"></td>
													<td th:text="${data['lab'].instanceName}"></td>
													<td th:text="${data['lab'].ipAddress}"></td>
													<td th:text="${data['lab'].instanceUser}"></td>
													<td th:text="${data['lab'].password}"></td>
													<td th:text="${data['os']}"></td>
													<td>
														<span th:if="${data['lab'].Status == 'Completed'}" class="badge badge-success">
															<i class="fas fa-circle status-indicator status-active"></i>
															Completed
														</span>
														<span th:unless="${data['lab'].Status == 'Completed'}" class="badge badge-warning">
															<i class="fas fa-circle status-indicator status-pending"></i>
															In Progress
														</span>
													</td>

													<td>
														<div class="progress-container">
															<div class="progress-bar" th:style="'width: ' + ${data['percentage']} + '%;'"></div>
															<div class="progress-text" th:text="${data['percentage']} + '%'"></div>
														</div>
													</td>

													<td th:text="${data['lab'].VmState}"></td>

													<td>
														<!-- Hide View Console button for completed labs -->
														<a th:if="${data['lab'].Status != 'Completed'}" 
														   class="btn btn-sm btn-assessment console-link"
														   th:href="@{|/guac/assessmentviewPlaylistConnection/${data['lab'].guacamoleId}|}"
														   title="Access Virtual Machine Console">
															<i class="fas fa-desktop"></i> View Console
														</a>
														<span th:if="${data['lab'].Status == 'Completed'}" class="text-muted">
															<i class="fas fa-check-circle"></i> Completed
														</span>
													</td>
												</tr>
											</th:block>

											<tr th:if="${labData == null or labData.empty}">
												<td colspan="11" class="text-muted text-center">
													<i class="fas fa-inbox fa-2x mb-2"></i><br> No active assessment labs found.
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>

		<!-- Footer -->
		<div th:replace="fragments/footer :: footer"></div>
	</div>

	<div th:replace="template :: jsscript"></div>

	<!-- Bootstrap JS for dropdowns -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

	<script>
		// Timer functionality
		function startTimer(duration, display) {
			let timer = duration, minutes, seconds;
			const timerContainer = document.getElementById('timerContainer');
			
			const interval = setInterval(function () {
				minutes = parseInt(timer / 60, 10);
				seconds = parseInt(timer % 60, 10);

				minutes = minutes < 10 ? "0" + minutes : minutes;
				seconds = seconds < 10 ? "0" + seconds : seconds;

				display.textContent = minutes + ":" + seconds;

				// Update timer container class based on remaining time
				if (timer <= 300) { // 5 minutes
					timerContainer.classList.add('timer-danger');
					timerContainer.classList.remove('timer-warning');
				} else if (timer <= 900) { // 15 minutes
					timerContainer.classList.add('timer-warning');
					timerContainer.classList.remove('timer-danger');
				} else {
					timerContainer.classList.remove('timer-warning', 'timer-danger');
				}

				if (--timer < 0) {
					clearInterval(interval);
					display.textContent = "TIME'S UP!";
					timerContainer.classList.add('timer-danger');
					
					// Show time up message
					Swal.fire({
						icon: 'warning',
						title: 'Time Expired!',
						html: 'Assessment time has ended. Your work will be submitted automatically.',
						confirmButtonText: 'OK',
						allowOutsideClick: false
					});
				}
			}, 1000);
		}

		// Function to check if all VMs are completed
		function checkAllVMsCompleted() {
			const completedVMs = document.querySelectorAll('tr td .badge-success').length;
			const totalVMs = document.querySelectorAll('tr td .badge').length;
			
			return completedVMs === totalVMs && totalVMs > 0;
		}

		// Function to calculate and display score summary
		function showScoreSummary() {
			const scoreSummarySection = document.getElementById('scoreSummarySection');
			const totalScoreElement = document.getElementById('totalScore');
			const scoreBreakdownElement = document.getElementById('scoreBreakdown');
			
			// Calculate total score (average of all VM progress percentages)
			const progressElements = document.querySelectorAll('.progress-text');
			let totalPercentage = 0;
			let vmCount = 0;
			
			progressElements.forEach(element => {
				const percentage = parseInt(element.textContent);
				if (!isNaN(percentage)) {
					totalPercentage += percentage;
					vmCount++;
				}
			});
			
			const averageScore = vmCount > 0 ? Math.round(totalPercentage / vmCount) : 0;
			totalScoreElement.textContent = averageScore + '%';
			
			// Create score breakdown
			scoreBreakdownElement.innerHTML = '';
			document.querySelectorAll('tbody tr').forEach(row => {
				const labName = row.cells[1].textContent;
				const progressText = row.querySelector('.progress-text').textContent;
				const progress = parseInt(progressText);
				
				if (!isNaN(progress)) {
					const scoreItem = document.createElement('div');
					scoreItem.className = 'score-item';
					scoreItem.innerHTML = `
						<h4>${labName}</h4>
						<div class="score">${progress}%</div>
					`;
					scoreBreakdownElement.appendChild(scoreItem);
				}
			});
			
			// Show score summary and hide other sections
			scoreSummarySection.classList.remove('hidden-section');
			document.getElementById('instructionsSection').classList.add('hidden-section');
			document.getElementById('timerSection').classList.add('hidden-section');
			document.getElementById('guidelinesSection').classList.add('hidden-section');
			document.getElementById('labsSection').classList.add('hidden-section');
		}

		// Function to periodically check if all VMs are completed
		function startCompletionCheck() {
			setInterval(() => {
				if (checkAllVMsCompleted()) {
					showScoreSummary();
				}
			}, 5000); // Check every 5 seconds
		}

		document.addEventListener('DOMContentLoaded', function() {
			const startButton = document.getElementById('startAssessmentBtn');
			const timerSection = document.getElementById('timerSection');
			const guidelinesSection = document.getElementById('guidelinesSection');
			const labsSection = document.getElementById('labsSection');
			const instructionsSection = document.querySelector('.instructions-section');
			
			// Check if all VMs are already completed on page load
			if (checkAllVMsCompleted()) {
				showScoreSummary();
			} else {
				// Custom SweetAlert2 styling for assessment
				const swalWithAssessmentTheme = Swal.mixin({
					customClass: {
						confirmButton: 'btn btn-assessment',
						cancelButton: 'btn btn-secondary'
					},
					buttonsStyling: false
				});

				// Start Assessment Button Handler
				startButton.addEventListener('click', function() {
					swalWithAssessmentTheme.fire({
						title: 'Start Assessment?',
						html: `
							<div style="text-align: left;">
								<p><strong>Important Instructions:</strong></p>
								<ul style="text-align: left; margin-left: 1rem;">
									<li>Do not close this browser window</li>
									<li>Do not switch to other tabs</li>
									<li>Timer cannot be paused once started</li>
									<li>Ensure stable internet connection</li>
									<li>Complete all tasks before time ends</li>
								</ul>
								<p class="text-danger"><strong>Are you ready to begin?</strong></p>
							</div>
						`,
						icon: 'warning',
						showCancelButton: true,
						confirmButtonText: '<i class="fas fa-play"></i> Yes, Start Assessment',
						cancelButtonText: 'Cancel',
						reverseButtons: true,
						width: '600px'
					}).then((result) => {
						if (result.isConfirmed) {
							// Hide instructions and start button
							instructionsSection.style.display = 'none';
							
							// Show timer, guidelines, and labs
							timerSection.classList.remove('hidden-section');
							guidelinesSection.classList.remove('hidden-section');
							labsSection.classList.remove('hidden-section');
							
							// Start the timer
							const timerDisplay = document.getElementById('timerDisplay');
							if (timerDisplay) {
								const timeString = timerDisplay.textContent;
								const [minutes, seconds] = timeString.split(':').map(Number);
								const totalSeconds = minutes * 60 + seconds;
								
								if (totalSeconds > 0) {
									startTimer(totalSeconds, timerDisplay);
								}
							}
							
							// Start checking for completion
							startCompletionCheck();
							
							// Show confirmation
							Swal.fire({
								icon: 'success',
								title: 'Assessment Started!',
								html: 'Your assessment timer has started. Good luck!',
								confirmButtonText: 'Continue',
								timer: 3000
							});
							
							// Animate progress bars on scroll into view
							const observerOptions = {
								root: null,
								rootMargin: '0px',
								threshold: 0.1
							};

							const observer = new IntersectionObserver((entries) => {
								entries.forEach(entry => {
									if (entry.isIntersecting) {
										const progressBar = entry.target.querySelector('.progress-bar');
										const width = progressBar.style.width;
										progressBar.style.width = '0';
										setTimeout(() => {
											progressBar.style.width = width;
										}, 100);
										observer.unobserve(entry.target);
									}
								});
							}, observerOptions);

							document.querySelectorAll('.progress-container').forEach(container => {
								observer.observe(container);
							});
						}
					});
				});

				// Action button handlers (same as normal page but with assessment endpoints)
				document.querySelectorAll('.stop-lab-btn').forEach(button => {
					button.addEventListener('click', function(e) {
						e.preventDefault();
						const containerName = this.getAttribute('data-container-name');
						stopAssessmentLab(containerName);
					});
				});

				document.querySelectorAll('.start-lab-btn').forEach(button => {
					button.addEventListener('click', function(e) {
						e.preventDefault();
						const containerName = this.getAttribute('data-container-name');
						startAssessmentLab(containerName);
					});
				});

				document.querySelectorAll('.remove-lab-btn').forEach(button => {
					button.addEventListener('click', function(e) {
						e.preventDefault();
						const containerName = this.getAttribute('data-container-name');
						removeAssessmentLab(containerName);
					});
				});

				document.querySelectorAll('.reset-lab-btn').forEach(button => {
					button.addEventListener('click', function(e) {
						e.preventDefault();
						const containerName = this.getAttribute('data-container-name');
						resetAssessmentLab(containerName);
					});
				});

				function startAssessmentLab(containerName) {
					swalWithAssessmentTheme.fire({
						title: 'Start Assessment Lab?',
						html: `Are you sure you want to start <b>${containerName}</b>?`,
						icon: 'question',
						showCancelButton: true,
						confirmButtonText: '<i class="fas fa-play"></i> Start Lab',
						cancelButtonText: 'Cancel'
					}).then((result) => {
						if (result.isConfirmed) {
							$.ajax({
								type: "POST",
								url: '/guac/assessment/start_lab',
								data: {
									"containerName": containerName
								},
								success: function(result) {
									if (result === 'success') {
										swalWithAssessmentTheme.fire({
											icon: 'success',
											title: 'Started!',
											html: `Assessment Lab <b>${containerName}</b> has been started successfully.`,
											confirmButtonText: 'OK'
										}).then(() => {
											location.reload();
										});
									} else {
										swalWithAssessmentTheme.fire({
											icon: 'error',
											title: 'Oops...',
											text: 'Failed to start the assessment lab!'
										});
									}
								},
								error: function() {
									swalWithAssessmentTheme.fire({
										icon: 'error',
										title: 'Oops...',
										text: 'Failed to start the assessment lab!'
									});
								}
							});
						}
					});
				}

				function stopAssessmentLab(containerName) {
					swalWithAssessmentTheme.fire({
						title: 'Stop Assessment Lab?',
						html: `Are you sure you want to stop <b>${containerName}</b>?`,
						icon: 'question',
						showCancelButton: true,
						confirmButtonText: '<i class="fas fa-stop"></i> Stop Lab',
						cancelButtonText: 'Cancel'
					}).then((result) => {
						if (result.isConfirmed) {
							$.ajax({
								type: "POST",
								url: '/guac/assessment/stop_lab',
								data: {
									"containerName": containerName
								},
								success: function(result) {
									if (result === 'success') {
										swalWithAssessmentTheme.fire({
											icon: 'success',
											title: 'Stopped!',
											html: `Assessment Lab <b>${containerName}</b> has been stopped successfully.`,
											confirmButtonText: 'OK'
										}).then(() => {
											location.reload();
										});
									} else {
										swalWithAssessmentTheme.fire({
											icon: 'error',
											title: 'Oops...',
											text: 'Failed to stop the assessment lab!'
										});
									}
								},
								error: function() {
									swalWithAssessmentTheme.fire({
										icon: 'error',
										title: 'Oops...',
										text: 'Failed to stop the assessment lab!'
									});
								}
							});
						}
					});
				}

				function removeAssessmentLab(containerName) {
					swalWithAssessmentTheme.fire({
						title: 'Remove Assessment Lab?',
						html: `Are you sure you want to remove <b>${containerName}</b>?<br><span class="text-danger">This action cannot be undone!</span>`,
						icon: 'warning',
						showCancelButton: true,
						confirmButtonText: '<i class="fas fa-trash"></i> Yes, remove it!',
						cancelButtonText: 'Cancel',
						reverseButtons: true
					}).then((result) => {
						if (result.isConfirmed) {
							$.ajax({
								type: "POST",
								url: '/guac/assessment/remove_lab',
								data: {
									"containerName": containerName
								},
								success: function(result) {
									if (result === 'success') {
										swalWithAssessmentTheme.fire({
											icon: 'success',
											title: 'Removed!',
											html: `Assessment Lab <b>${containerName}</b> has been removed successfully.`,
											confirmButtonText: 'OK'
										}).then(() => {
											location.reload();
										});
									} else {
										swalWithAssessmentTheme.fire({
											icon: 'error',
											title: 'Oops...',
											text: 'Failed to remove the assessment lab!'
										});
									}
								},
								error: function() {
									swalWithAssessmentTheme.fire({
										icon: 'error',
										title: 'Oops...',
										text: 'Failed to remove the assessment lab!'
									});
								}
							});
						}
					});
				}

				function resetAssessmentLab(containerName) {
					swalWithAssessmentTheme.fire({
						title: 'Reset Assessment Lab?',
						html: `This will reset <b>${containerName}</b> to its initial state.<br><span class="text-warning">All progress will be lost!</span>`,
						icon: 'warning',
						showCancelButton: true,
						confirmButtonText: '<i class="fas fa-redo"></i> Yes, reset it!',
						cancelButtonText: 'Cancel'
					}).then((result) => {
						if (result.isConfirmed) {
							$.ajax({
								type: "POST",
								url: '/guac/assessment/reset_lab',
								data: {
									"containerName": containerName
								},
								success: function(result) {
									if (result === 'success') {
										swalWithAssessmentTheme.fire({
											icon: 'success',
											title: 'Reset!',
											html: `Assessment Lab <b>${containerName}</b> has been reset successfully.`,
											confirmButtonText: 'OK'
										}).then(() => {
											location.reload();
										});
									} else {
										swalWithAssessmentTheme.fire({
											icon: 'error',
											title: 'Oops...',
											text: 'Failed to reset the assessment lab!'
										});
									}
								},
								error: function() {
									swalWithAssessmentTheme.fire({
										icon: 'error',
										title: 'Oops...',
										text: 'Failed to reset the assessment lab!'
									});
								}
							});
						}
					});
				}
			}
		});
	</script>

</body>

</html>