<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Edit Template</title>
<link rel="icon" type="image/png"
	href="/webtemplate/dist/img/magicboxEye3.png">

<!-- Common CSS -->
<link rel="stylesheet" th:href="@{/css/fontAwesome.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/fontawesome-free/css/all.min.css}">
<link rel="stylesheet" th:href="@{/css/ionicIcons.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/icheck-bootstrap/icheck-bootstrap.min.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/jqvmap/jqvmap.min.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/dist/css/adminlte.min.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/overlayScrollbars/css/OverlayScrollbars.min.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/daterangepicker/daterangepicker.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/summernote/summernote-bs4.min.css}">

<link rel="stylesheet"
	th:href="@{/webtemplate/css/cloudfont-awesome.min.css}">
<link rel="stylesheet" type="text/css"
	th:href="@{/webtemplate/plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/select2/css/select2.min.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/datatables-responsive/css/responsive.bootstrap4.min.css}">
<link rel="stylesheet"
	th:href="@{/webtemplate/plugins/datatables-buttons/css/buttons.bootstrap4.min.css}">

<!-- Summernote CSS -->
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/summernote-bs4.min.css">

<style>
.glowBtn {
	background-color: #1c87c9;
	border-radius: 5px;
	border: none;
	color: #eeeeee;
	cursor: pointer;
	display: inline-block;
	font-family: sans-serif;
	font-size: 20px;
	padding: 5px 15px;
	text-align: center;
	text-decoration: none;
}

@
keyframes glowing { 0% {
	background-color: #2ba805;
	box-shadow: 0 0 5px #2ba805;
}

50
%
{
background-color
:
#49e819;
box-shadow
:
0
0
20px
#49e819;
}
100
%
{
background-color
:
#2ba805;
box-shadow
:
0
0
5px
#2ba805;
}
}
.glowBtn {
	animation: glowing 1300ms infinite;
}

th {
	text-align: center;
}

td {
	text-align: center;
}

.info-box-text {
	font-family: math;
	font-size: larger;
}

.current-image {
    max-width: 200px;
    max-height: 150px;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 5px;
    margin-top: 10px;
}
</style>
</head>
<body class="hold-transition sidebar-mini layout-fixed">
	<div class="wrapper">
		<!-- Header -->
		<div th:replace="fragments/header_bk :: header"></div>
		<!--Close Header -->

		<!-- Sidebar -->
		<div th:replace="fragments/sidebar :: aside"></div>
		<!-- Close Sidebar -->
		<div class="content-wrapper">
			<div class="container-fluid">
				<div class="row mb-2">
					<div class="col-sm-6">
						<h2 class="m-0">Edit Template</h2>
					</div>
				</div>
			</div>

			<!-- Edit Form -->
			<form th:action="@{/cloud_instance/updateTemplate}" method="post"
				enctype="multipart/form-data" th:object="${cloudInstance}">
				<input type="hidden" th:field="*{id}" />

				<!-- Instance Name -->
				<section class="content">
					<div class="container-fluid">
						<div class="row">
							<div class="col-md-12" style="padding-top: 10px">
								<!-- PIE CHART -->
								<div class="card border-transparent">
									<div class="card-header">
										<h3 class="card-title"
											style="align-items: flex-start !important; flex-direction: column !important; display: flex;">
											<span class="card-title" style="font-weight: bold;">Template
												Name</span> <span class="card-title"
												style="font-size: 1rem !important; color: #b5b5c3 !important">Provide
												Template Name</span>
										</h3>
									</div>
									<div class="card-body">
										<div class="form-group">
											<input tabindex="2" type="text" th:field="*{instance_name}"
												required id="instance_name" name="instance_name"
												class="form-control" placeholder="Enter Cloud Lab Name" />
										</div>
									</div>
									<!-- /.card-body -->
								</div>
								<!-- /.card -->
							</div>
						</div>
					</div>
				</section>
				<!-- End Instance Name -->

				<!-- Start Lab Image -->
				<section class="content">
					<div class="container-fluid">
						<div class="row">
							<div class="col-md-12">
								<!-- PIE CHART -->
								<div class="card border-transparent">
									<div class="card-header">
										<h3 class="card-title"
											style="align-items: flex-start !important; flex-direction: column !important; display: flex;">
											<span class="card-title" style="font-weight: bold;">Template
												Image</span> <span class="card-title"
												style="font-size: 1rem !important; color: #b5b5c3 !important">Provide
												Template Image</span>
										</h3>
									</div>
									<div class="card-body">
										<!-- Display current image if exists -->
										<div th:if="${cloudInstance.lab_image != null}" class="mb-3">
											
											<img th:src="@{'/cloud_instance/image/' + ${cloudInstance.id}}" 
												 alt="Current Template Image" 
												 class="current-image"
												 onerror="this.style.display='none'"/>
											
											
										</div>
										
										<div class="form-group">
											<div class="custom-file">
												<input type="file" class="custom-file-input"
													id="uploadedImage" name="uploadedImage" accept="image/*">
												<label class="custom-file-label" for="uploadedImage">
													<span th:if="${cloudInstance.lab_image != null}">Change Template image file</span>
													<span th:unless="${cloudInstance.lab_image != null}">Choose Template image file</span>
												</label>
											</div>
											<small class="form-text text-muted">Recommended size:
												1200x630 pixels</small>
										</div>
									</div>
									<!-- /.card-body -->
								</div>
								<!-- /.card -->
							</div>
						</div>
					</div>
				</section>
				<!-- End Lab Image -->

				<!-- Start Lab Tag -->
				<section class="content">
					<div class="container-fluid">
						<div class="row">
							<div class="col-md-12">
								<!-- PIE CHART -->
								<div class="card border-transparent">
									<div class="card-header">
										<h3 class="card-title"
											style="align-items: flex-start !important; flex-direction: column !important; display: flex;">
											<span class="card-title" style="font-weight: bold;">Template
												Tag</span> <span class="card-title"
												style="font-size: 1rem !important; color: #b5b5c3 !important">Provide
												Template Tag</span>
										</h3>
									</div>
									<div class="card-body">
										<div class="form-group">
											<input tabindex="2" type="text" th:field="*{lab_tag}"
												required id="lab_tag" name="lab_tag" class="form-control"
												placeholder="Enter Cloud Lab Tag" />
										</div>
									</div>
									<!-- /.card-body -->
								</div>
								<!-- /.card -->
							</div>
						</div>
					</div>
				</section>
				<!-- End Lab Tag -->

				<!-- Start Lab Username -->
				<section class="content">
					<div class="container-fluid">
						<div class="row">
							<div class="col-md-12">
								<div class="card border-transparent">
									<div class="card-header">
										<h3 class="card-title"
											style="align-items: flex-start; flex-direction: column; display: flex;">
											<span style="font-weight: bold;">UserName</span> <span
												style="font-size: 1rem; color: #b5b5c3;">Provide
												UserName</span>
										</h3>
									</div>
									<div class="card-body">
										<div class="form-group">
											<input tabindex="1" type="text" th:field="*{ConsoleUsername}"
												required class="form-control"
												placeholder="Enter Cloud UserName" />
										</div>
									</div>
								</div>
								<!-- /.card -->
							</div>
						</div>
					</div>
				</section>
				<!-- End Lab Username -->

				<!-- Start Lab Password -->
				<section class="content">
					<div class="container-fluid">
						<div class="row">
							<div class="col-md-12">
								<div class="card border-transparent">
									<div class="card-header">
										<h3 class="card-title"
											style="align-items: flex-start; flex-direction: column; display: flex;">
											<span style="font-weight: bold;">Password</span> <span
												style="font-size: 1rem; color: #b5b5c3;">Provide
												Password</span>
										</h3>
									</div>
									<div class="card-body">
										<div class="form-group">
											<input tabindex="2" type="password"
												th:field="*{instance_password}" 
												th:attr="value=${cloudInstance.instance_password}"
												class="form-control"
												placeholder="Enter Cloud Password" />
											<small class="form-text text-muted">Leave blank to keep current password unchanged</small>
										</div>
									</div>
								</div>
								<!-- /.card -->
							</div>
						</div>
					</div>
				</section>
				<!-- End Lab Password -->

				<!-- Start Lab ConsoleProtocol -->
				<section class="content">
					<div class="container-fluid">
						<div class="row">
							<div class="col-md-12">
								<!-- Protocol -->
								<div class="card border-transparent">
									<div class="card-header">
										<h3 class="card-title"
											style="display: flex; flex-direction: column;">
											<span style="font-weight: bold;">Protocol</span> <span
												style="font-size: 1rem; color: #b5b5c3;">Provide
												Protocol</span>
										</h3>
									</div>
									<div class="card-body">
										<div class="form-group">
											<select th:field="*{ConsoleProtocol}" required
												class="form-control" style="width: 100%;">
												<option value="">SELECT</option>
												<option value="rdp">RDP</option>
												<option value="ssh">SSH</option>
												<option value="vnc">VNC</option>
												<option value="telnet">Telnet</option>
												<option value="kubernetes">Kubernetes</option>
											</select>
										</div>
									</div>
								</div>
								<!-- /.card -->
							</div>
						</div>
					</div>
				</section>
				<!-- End Lab ConsoleProtocol -->

				<!-- Security Mode -->
				<section class="content">
					<div class="container-fluid">
						<div class="row">
							<div class="col-md-12">
								<!-- Security Mode Dropdown -->
								<div class="card border-transparent">
									<div class="card-header">
										<h3 class="card-title"
											style="display: flex; flex-direction: column;">
											<span style="font-weight: bold;">Security Mode</span> <span
												style="font-size: 1rem; color: #b5b5c3;">Select
												Security Mode</span>
										</h3>
									</div>
									<div class="card-body">
										<div class="form-group">
											<select class="form-control" th:field="*{SecurityMode}"
												style="width: 100%;">
												<option value="">SELECT</option>
												<option value="any">Any</option>
												<option value="nla">NLA (Network Level
													Authentication)</option>
												<option value="rdp">RDP Security</option>
												<option value="tls">TLS</option>
											</select>
										</div>
									</div>
								</div>
								<!-- /.card -->
							</div>
						</div>
					</div>
				</section>
				<!-- End Security Mode -->

				<!-- Server Certificate -->
				<div class="card border-transparent mt-3">
					<div class="card-header">
						<h3 class="card-title"
							style="display: flex; flex-direction: column;">
							<span style="font-weight: bold;">Server Certificate</span> <span
								style="font-size: 1rem; color: #b5b5c3;">Enable or
								disable server certificate validation</span>
						</h3>
					</div>
					<div class="card-body">
						<div class="form-check">
							<input class="form-check-input" type="checkbox"
								id="enableServerCert" name="enableServerCert"
								th:checked="${cloudInstance.ServerCertificate != null && !cloudInstance.ServerCertificate.isEmpty()}">
							<label class="form-check-label" for="enableServerCert"> Enable
								Server Certificate Validation </label>
						</div>

						<!-- Optional dropdown that appears only when checkbox is checked -->
						<div class="form-group mt-3" id="serverCertOptions">
							<label for="serverCertificate">Validation Mode</label> 
							<select class="form-control" id="serverCertificate"
								th:field="*{ServerCertificate}" name="ServerCertificate">
								<option value="">SELECT</option>
								<option value="ignore">Ignore</option>
								<option value="trust">Trust only system CA certificates</option>
								<option value="trust-all">Trust all certificates
									(insecure)</option>
								<option value="validate">Validate server certificate
									(recommended)</option>
							</select>
						</div>
					</div>
				</div>
				<!-- End Server Certificate -->

				<!-- Start Lab Description -->
				<section class="content">
					<div class="container-fluid">
						<div class="row">
							<div class="col-md-12">
								<div class="card border-transparent">
									<div class="card-header">
										<h3 class="card-title"
											style="align-items: flex-start !important; flex-direction: column !important; display: flex;">
											<span class="card-title" style="font-weight: bold;">Description</span>
											<span class="card-title"
												style="font-size: 1rem !important; color: #b5b5c3 !important">Provide
												Description</span>
										</h3>
									</div>
									<div class="card-body">
										<div class="form-group">
											<input tabindex="2" type="text" th:field="*{description}"
												required id="description" name="description"
												class="form-control" placeholder="Enter Cloud Description" />
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</section>
				<!-- End Lab Description -->

				<!-- virtualization type -->
				<section class="content">
					<div class="container-fluid">
						<div class="row">
							<div class="col-md-12">
								<!-- PIE CHART -->
								<div class="card border-transparent">
									<div class="card-header">
										<h3 class="card-title"
											style="align-items: flex-start !important; flex-direction: column !important; display: flex;">
											<span class="card-title" style="font-weight: bold;">Virtualization
												Type</span> <span class="card-title"
												style="font-size: 1rem !important; color: #b5b5c3 !important">Select
												Virtualization Type</span>
										</h3>
									</div>
									<div class="card-body">
										<div class="form-group">
											<select tabindex="1" id="virtualization_type"
												th:field="*{virtualization_type}" required
												name="virtualization_type" class="form-control"
												data-placeholder="Select switch" style="width: 100%;">
												<option value=''>SELECT</option>
												<option value='KVM'>KVM</option>
												<option value='hyperv'>Hyper-V</option>
												<option value='Docker'>Docker</option>
												<option value='OpenStack'>OpenStack</option>
												<option value='Proxmox'>Proxmox</option>
											</select>
										</div>
									</div>
									<!-- /.card-body -->
								</div>
								<!-- /.card -->
							</div>
						</div>
					</div>
				</section>
				<!-- End virtualization type  -->

				<!-- Physical Server IP -->
				<section class="content">
					<div class="container-fluid">
						<div class="row">
							<div class="col-md-12">
								<!-- PIE CHART -->
								<div class="card border-transparent">
									<div class="card-header">
										<h3 class="card-title"
											style="align-items: flex-start !important; flex-direction: column !important; display: flex;">
											<span class="card-title" style="font-weight: bold;">Physical
												server IP</span> <span class="card-title"
												style="font-size: 1rem !important; color: #b5b5c3 !important">Enter
												server ip address</span>
										</h3>
									</div>
									<div class="card-body">
										<div class="form-group">
											<input tabindex="1" type="text" id="physicalServerIP"
												th:field="*{physicalServerIP}" required
												name="physicalServerIP" class="form-control"
												placeholder="Enter Physical Server IP" style="width: 100%;" />
										</div>
									</div>
									<!-- /.card-body -->
								</div>
								<!-- /.card -->
							</div>
						</div>
					</div>
				</section>
				<!-- End Physical Server IP -->

				<!-- Cloud Instance Password -->
				<section class="content">
					<div class="container-fluid">
						<div class="form-group" style="padding-top: 10px;">
							<button id="updateVMBtn" type="submit" class="glowBtn">
								Update Template <i
									style="margin-left: 10px; color: yellow; display: none"
									id="vmUpdateSpinner" class='fa fa-spinner fa-spin'></i>
							</button>
							<a th:href="@{/cloud_instance/view}"
								class="btn btn-secondary ml-3"> Cancel </a>
						</div>
					</div>
				</section>
				<!-- End Cloud Instance Password -->
			</form>
		</div>
	</div>

	<!-- Footer -->
	<div th:replace="fragments/footer :: footer"></div>
	<!--Close Footer -->

	<!-- Common JS  -->
	<script th:src="@{/webtemplate/plugins/jquery/jquery.min.js}"></script>
	<script th:src="@{/webtemplate/plugins/jquery-ui/jquery-ui.min.js}"></script>
	<script>
		$.widget.bridge('uibutton', $.ui.button)
	</script>
	<!-- Bootstrap 4 -->
	<script
		th:src="@{/webtemplate/plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
	<!-- ChartJS -->
	<script th:src="@{/webtemplate/plugins/chart.js/Chart.min.js}"></script>
	<!-- Tempusdominus Bootstrap 4 -->
	<script
		th:src="@{/webtemplate/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js}"></script>
	<!-- Summernote -->
	<script
		th:src="@{/webtemplate/plugins/summernote/summernote-bs4.min.js}"></script>
	<!-- overlayScrollbars -->
	<script
		th:src="@{/webtemplate/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js}"></script>
	<!-- AdminLTE App -->
	<script th:src="@{/webtemplate/dist/js/adminlte.js}"></script>
	<!-- AdminLTE for demo purposes -->
	<script th:src="@{/webtemplate/dist/js/demo.js}"></script>

	<script
		th:src="@{/webtemplate/plugins/jquery-validation/jquery.validate.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/jquery-validation/additional-methods.min.js}"></script>
	<script th:src="@{/webtemplate/plugins/sweetalert2/sweetalert2.min.js}"></script>
	<script th:src="@{/webtemplate/plugins/select2/js/select2.full.min.js}"></script>

	<script
		th:src="@{/webtemplate/plugins/datatables/jquery.dataTables.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-responsive/js/dataTables.responsive.min.js}"></script>
	<script
		th:src="@{/webtemplate/plugins/datatables-responsive/js/responsive.bootstrap4.min.js}"></script>

	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/summernote-bs4.min.js"></script>

	<script>
		$(document).ready(function() {
			// Initialize select2
			$('select').select2({
				theme : 'bootstrap4'
			});

			// File input label update
			document.getElementById('uploadedImage').addEventListener('change', function(e) {
				if (this.files && this.files[0]) {
					var fileName = this.files[0].name;
					var nextSibling = e.target.nextElementSibling;
					nextSibling.innerText = fileName;
				}
			});

			// Server certificate toggle - initialize based on current value
			const serverCertValue = /*[[${cloudInstance.ServerCertificate}]]*/ null;
			const enableServerCertCheckbox = document.getElementById("enableServerCert");
			const serverCertOptions = document.getElementById("serverCertOptions");
			
			// Show/hide server certificate options based on current value
			if (serverCertValue && serverCertValue.trim() !== '') {
				serverCertOptions.style.display = "block";
			} else {
				serverCertOptions.style.display = "none";
			}
			
			// Toggle on checkbox change
			enableServerCertCheckbox.addEventListener("change", function() {
				serverCertOptions.style.display = this.checked ? "block" : "none";
				if (!this.checked) {
					document.getElementById("serverCertificate").value = "";
				}
			});

			// Form submission handling
			$('form').on('submit', function(e) {
				const submitBtn = $(this).find('button[type="submit"]');
				submitBtn.prop('disabled', true);
				$('#vmUpdateSpinner').show();
			});

			// Show success/error messages
			const successMessage = /*[[${successMessage}]]*/null;
			const errorMessage = /*[[${errorMessage}]]*/null;

			if (successMessage) {
				Swal.fire({
					position : "top",
					icon : "success",
					title : successMessage,
					showConfirmButton : false,
					timer : 3000
				});
			}

			if (errorMessage) {
				Swal.fire({
					position : "top",
					icon : "error",
					title : errorMessage,
					showConfirmButton : true
				});
			}
		});
	</script>
</body>
</html>