<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head th:include="template :: headFragment(${pageTitle})">
<title>Create Playlist | Cyber Ranges</title>
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Summernote CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css"
	rel="stylesheet">
<style>
/* Your existing CSS remains the same */
:root {
	--primary: #3498db;
	--secondary: #2c3e50;
	--light: #ecf0f1;
	--dark: #1a252f;
	--success: #2ecc71;
	--danger: #e74c3c;
	--warning: #f39c12;
	--info: #1abc9c;
}

/* ... rest of your CSS remains unchanged ... */
</style>
</head>

<body class="hold-transition sidebar-mini layout-fixed">
	<div class="wrapper">

		<div th:replace="fragments/header :: header"></div>

		<div th:replace="fragments/sidebar :: aside"></div>

		<div class="content-wrapper">

			<section class="content-header">
				<div class="container-fluid">
					<div class="row mb-2">
						<div class="col-sm-6">
<!-- 							<h1 -->
<!-- 								th:text="${playlist.Id == 0} ? 'Create New Playlist' : 'Edit Playlist'">[[${pageTitle}]]</h1> -->
						</div>
						<div class="col-sm-6">
							<ol class="breadcrumb float-sm-right">
								<li class="breadcrumb-item"><a th:href="@{/guac/View_Playlist}"><i
										class="fas fa-home"></i> Playlist</a></li>
							</ol>
						</div>
					</div>
				</div>
			</section>

			<section class="content">
				<div class="container-fluid">
					<div class="row">
						<div class="col-md-12">
							<div class="card">
								<div class="card-header">
									<div class="d-flex justify-content-between align-items-center">
										<h3 class="card-title">
											<i class="fas fa-list playlist-icon"></i> <span
												th:text="${playlist.Id == 0} ? 'Playlist Details' : 'Edit Playlist Details'">Playlist
												Details</span>
										</h3>
										<div class="card-tools">
											<button type="button" class="btn btn-tool"
												data-card-widget="collapse">
												<i class="fas fa-minus"></i>
											</button>
										</div>
									</div>
								</div>

								<form th:action="@{/guac/playlistsave}" method="post"
									th:object="${playlist}" enctype="multipart/form-data"
									onsubmit="return validatePlaylistForm()">

									<input type="hidden" th:field="*{Id}" />
									<div class="row">
										<div class="col-md-6">
											<div class="form-group">
												<label for="playlist_name" class="required-field">Playlist
													Name</label> <input type="text" th:field="*{playlistName}"
													id="playlist_name" class="form-control"
													placeholder="Enter playlist name" required />
												<div class="invalid-feedback d-none">Please enter a
													playlist name.</div>
											</div>
										</div>

										<div class="col-md-6">
											<div class="form-group">
												<label for="playlist_title" class="required-field">Playlist
													Title</label> <input type="text" th:field="*{playlistTitle}"
													id="playlist_title" class="form-control"
													placeholder="Enter playlist title" required />
												<div class="invalid-feedback d-none">Please enter a
													playlist title.</div>
											</div>
										</div>

									</div>

									<div class="row">
										<div class="col-md-12">
											<div class="form-group">
												<label for="description">Description</label>
												<textarea th:field="*{Description}" id="description"
													class="summernote form-control"
													placeholder="Describe this playlist"></textarea>
												<div id="descError" class="invalid-feedback d-none">Please
													provide a description.</div>
											</div>
										</div>
									</div>



									<div class="row">
										<div class="col-md-6">
											<!-- 											<div class="form-group"> -->
											<!-- 												<label for="cover_image">Playlist Cover Image</label> <input -->
											<!-- 													type="file" class="form-control-file" id="cover_image" -->
											<!-- 													name="cover_image" accept="image/*" /> -->
											<!-- 												<div class="upload-preview mt-2"> -->
											<!-- 													<img th:if="${playlist.coverImage != null}" -->
											<!-- 														th:src="@{'/guac/playlist-image/' + ${playlist.Id}}" -->
											<!-- 														alt="Cover Image" /> -->
											<!-- 												</div> -->
											<!-- 											</div> -->

											<div class="form-group">
												<label for="cover_image"> Cover Image</label>
												<!-- 												<div class="custom-file"> -->
												<!-- 													<input type="file" class="custom-file-input" -->
												<!-- 														id="cover_image" name="cover_image" accept="image/*"> -->
												<!-- 													<label class="custom-file-label" for="cover_image">Choose -->
												<!-- 														image</label> -->
												<!-- 														<div class="upload-preview mt-2"> -->
												<!-- 													<img th:if="${playlist.coverImage != null}" -->
												<!-- 														th:src="@{'/guac/playlist-image/' + ${playlist.Id}}" -->
												<!-- 														alt="Cover Image" /> -->
												<!-- 												</div> -->
												<!-- 												</div> -->
												<div class="custom-file">
													<input type="file" class="custom-file-input"
														id="cover_image" name="cover_image" accept="image/*">
													<label class="custom-file-label" for="cover_image"
														id="coverImageLabel"> <span
														th:if="${playlist.CoverImage != null}">Current
															image exists - choose new file to replace</span> <span
														th:unless="${playlist.CoverImage != null}">Choose
															file</span>
													</label>
												</div>
												<small class="form-text text-muted">Recommended
													size: 1200x630 pixels</small>
											</div>
										</div>

										<div class="col-md-6">
											<div class="form-group">
												<label for="tag_input" class="required-field">Tags</label> <input
													type="text" th:field="*{Tag}" id="tag_input"
													class="form-control" placeholder="Type to add tags"
													required />
												<div id="tagError" class="invalid-feedback d-none">Please
													enter tags.</div>
											</div>
										</div>

									</div>




									<input type="hidden" th:field="*{createdBy}" />

									<div class="text-right">
										<a href="#" class="btn btn-outline-secondary">Cancel</a>
										<button type="reset" class="btn btn-outline-secondary">Reset</button>
										<button type="submit" id="savePlaylistBtn"
											class="btn btn-primary">
											<i class="fas fa-save mr-1"></i> Save Playlist <span
												id="playlistSpinner"
												class="spinner-border spinner-border-sm ml-2 d-none"></span>
										</button>
									</div>
								</form>

								<script>
									function validatePlaylistForm() {
										let isValid = true;

										const name = $('#playlist_name');
										const title = $('#playlist_title');
										const desc = $('#description');
										const tags = $('#tag_input');

										if (!name.val().trim()) {
											name.addClass('is-invalid');
											name.next('.invalid-feedback')
													.removeClass('d-none');
											isValid = false;
										}

										if (!title.val().trim()) {
											title.addClass('is-invalid');
											title.next('.invalid-feedback')
													.removeClass('d-none');
											isValid = false;
										}

										const descText = desc
												.summernote('code').replace(
														/<[^>]*>/g, '').trim();
										if (!descText) {
											desc.addClass('is-invalid');
											$('#descError').removeClass(
													'd-none');
											isValid = false;
										}

										if (!tags.val().trim()) {
											tags.addClass('is-invalid');
											$('#tagError')
													.removeClass('d-none');
											isValid = false;
										}

										if (!isValid) {
											$('html, body')
													.animate(
															{
																scrollTop : $(
																		'.is-invalid:first')
																		.offset().top - 100
															}, 500);
											return false;
										}

										$('#playlistSpinner').removeClass(
												'd-none');
										$('#savePlaylistBtn').prop('disabled',
												true);
										return true;
									}

									$(document)
											.ready(
													function() {
														bsCustomFileInput
																.init();
														$('.summernote')
																.summernote(
																		{
																			height : 200
																		});

														$('input, textarea')
																.on(
																		'input change',
																		function() {
																			$(
																					this)
																					.removeClass(
																							'is-invalid');
																			$(
																					this)
																					.next(
																							'.invalid-feedback')
																					.addClass(
																							'd-none');
																		});

														$('#description')
																.on(
																		'summernote.change',
																		function() {
																			$(
																					'#descError')
																					.addClass(
																							'd-none');
																			$(
																					'#description')
																					.removeClass(
																							'is-invalid');
																		});
													});
								</script>


							</div>
						</div>
					</div>
				</div>
			</section>
		</div>

		<div th:replace="fragments/footer :: footer"></div>
	</div>

	<div th:replace="template :: jsscript"></div>

	<script
		src="https://cdn.jsdelivr.net/npm/bs-custom-file-input/dist/bs-custom-file-input.min.js"></script>
	<!-- Summernote JS -->
	<script
		src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>

	<script type="text/javascript">
		$(document)
				.ready(
						function() {
							// Initialize custom file input
							bsCustomFileInput.init();

							// Initialize Summernote with existing content
							$('.summernote')
									.summernote(
											{
												height : 200,
												toolbar : [
														[ 'style', [ 'style' ] ],
														[
																'font',
																[
																		'bold',
																		'italic',
																		'underline',
																		'clear' ] ],
														[ 'fontname',
																[ 'fontname' ] ],
														[ 'color', [ 'color' ] ],
														[
																'para',
																[ 'ul', 'ol',
																		'paragraph' ] ],
														[ 'height',
																[ 'height' ] ],
														[ 'table', [ 'table' ] ],
														[
																'insert',
																[
																		'link',
																		'picture',
																		'video' ] ],
														[
																'view',
																[
																		'fullscreen',
																		'codeview',
																		'help' ] ] ],
												styleTags : [ 'p', 'h1', 'h2',
														'h3', 'h4', 'h5', 'h6' ],
												fontNames : [ 'Arial',
														'Arial Black',
														'Comic Sans MS',
														'Courier New',
														'Helvetica', 'Impact',
														'Tahoma',
														'Times New Roman',
														'Verdana', 'Roboto' ],
												fontNamesIgnoreCheck : [ 'Roboto' ]
											});

							// Real-time validation
							$('input, textarea').on(
									'input change',
									function() {
										$(this).removeClass('is-invalid');
										$(this).next('.invalid-feedback')
												.addClass('d-none');
									});

							// File input change event
							$('#cover_image')
									.on(
											'change',
											function() {
												const file = this.files[0];
												if (file) {
													// Validate file type
													if (!file.type
															.startsWith('image/')) {
														$(this).addClass(
																'is-invalid');
														$(this)
																.next(
																		'.custom-file-label')
																.addClass(
																		'text-danger');
														$(this)
																.next(
																		'.custom-file-label')
																.text(
																		'Please select an image file');
													} else {
														$(this).removeClass(
																'is-invalid');
														$(this)
																.next(
																		'.custom-file-label')
																.removeClass(
																		'text-danger');
													}
												}
											});
						});

		function validatePlaylistForm() {
			let isValid = true;

			// Playlist Name validation
			if (!$('#playlistName').val().trim()) {
				$('#playlistName').addClass('is-invalid');
				$('#playlistName').next('.invalid-feedback').removeClass(
						'd-none');
				isValid = false;
			}

			// Playlist Title validation
			if (!$('#playlistTitle').val().trim()) {
				$('#playlistTitle').addClass('is-invalid');
				$('#playlistTitle').next('.invalid-feedback').removeClass(
						'd-none');
				isValid = false;
			}

			// Tags validation
			if (!$('#Tag').val().trim()) {
				$('#Tag').addClass('is-invalid');
				$('#Tag').next('.invalid-feedback').removeClass('d-none');
				isValid = false;
			}

			// File validation (if file is selected)
			const fileInput = $('#cover_image')[0];
			if (fileInput.files.length > 0) {
				const file = fileInput.files[0];
				if (!file.type.startsWith('image/')) {
					$('#cover_image').addClass('is-invalid');
					isValid = false;
				}
			}

			if (!isValid) {
				$('html, body').animate({
					scrollTop : $('.is-invalid:first').offset().top - 100
				}, 500);
				return false;
			}

			// Show spinner and disable button
			$('#playlistSpinner').removeClass('d-none');
			$('#savePlaylistBtn').prop('disabled', true);

			return true;
		}
	</script>
</body>
</html>